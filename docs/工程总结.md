# XTerm File Manager - Project Summary

## ğŸ”¥ Latest Update (2026-02-09)

### Version 2.34 - Terminal Enhancements & Configuration Fixes (2026-02-09)

**Critical Bug Fixes:**

1. **Local Terminal Chinese Input Fix**:
   - **Problem**: Local terminals couldn't input Chinese characters (garbled display), while SSH terminals worked fine
   - **Root Cause**: Local terminals were missing UTF-8 locale environment variables (`LANG`, `LC_ALL`)
   - **Solution**: Added `LANG=en_US.UTF-8` and `LC_ALL=en_US.UTF-8` to local terminal environment
   - **Result**: Local terminals now support multi-byte characters (Chinese, Japanese, Korean) identical to SSH terminals
   - **Location**: `internal/app/pty_unix.go:82-84`

2. **Local Terminal Delete Key Fix**:
   - **Problem**: Pressing Delete/Backspace in local terminals showed garbled characters (`^?` or `^H`) instead of deleting
   - **Root Cause**: Local terminals lacked proper `TERM` environment variable, defaulting to basic terminal type
   - **Solution**: Added `TERM=xterm-256color` environment variable (matches SSH terminal configuration at `terminal_handler.go:72`)
   - **Result**: Delete key now works correctly, all terminal control sequences function properly
   - **Location**: `internal/app/pty_unix.go:78-81`

**Configuration Improvements:**

3. **Vite Auto-Open Browser Disabled**:
   - **Problem**: Running `wails dev` auto-opened unwanted browser tab at `http://localhost:5173/`
   - **Root Cause**: Vite dev server defaults to `open: true` (auto-open browser)
   - **Solution**: Added `open: false` to `frontend/vite.config.ts` server configuration
   - **Why It Matters**: Eliminates user attention waste - Wails app window is the intended interface, not browser
   - **Location**: `frontend/vite.config.ts:16`

**Documentation Enhancements:**

4. **AGENTS.md Critical Configuration Section**:
   - **Purpose**: Prevent AI agents from repeating common configuration mistakes
   - **Added Two Critical Sections**:
     - "Vite Auto-Open Browser (MUST DISABLE)" - explains why and how to disable
     - "Local Terminal Environment Variables (MUST SET)" - explains TERM and UTF-8 locale requirements
   - **Content**: Includes problem description, root cause analysis, complete code examples, and testing steps
   - **Result**: Future AI development sessions won't forget these critical settings
   - **Location**: `AGENTS.md:363-431`

**Files Changed:**

**Backend (Go):**
- `internal/app/pty_unix.go` - Added TERM environment variable detection and UTF-8 locale settings (lines 68-85)

**Frontend (TypeScript):**
- `frontend/vite.config.ts` - Disabled auto-open browser (line 16)

**Documentation:**
- `AGENTS.md` - Added "Critical Configuration Settings" section with two subsections (73 new lines)
- `README.md` - Added v2.34 changelog entry
- `docs/å·¥ç¨‹æ€»ç»“.md` - This version summary
- `wails.json` - Updated version to 2.34

**Technical Details:**

Environment Variable Changes in `pty_unix.go`:
```go
// Before: No TERM or LANG checking
cleanEnv := make([]string, 0, len(os.Environ()))
for _, env := range os.Environ() {
    if len(env) >= 11 && env[:11] == "VIRTUAL_ENV" {
        continue
    }
    cleanEnv = append(cleanEnv, env)
}
cmd.Env = cleanEnv

// After: TERM detection + UTF-8 locale
cleanEnv := make([]string, 0, len(os.Environ()))
termSet := false
for _, env := range os.Environ() {
    if len(env) >= 11 && env[:11] == "VIRTUAL_ENV" {
        continue
    }
    if len(env) >= 5 && env[:5] == "TERM=" {
        termSet = true  // Detect existing TERM
    }
    cleanEnv = append(cleanEnv, env)
}
if !termSet {
    cleanEnv = append(cleanEnv, "TERM=xterm-256color")  // Match SSH terminal
}
cleanEnv = append(cleanEnv, "LANG=en_US.UTF-8")      // Multi-byte support
cleanEnv = append(cleanEnv, "LC_ALL=en_US.UTF-8")    // Force UTF-8
cmd.Env = cleanEnv
```

**Key Lessons:**

1. **Environment Parity**: Local terminals must have same environment as SSH terminals for consistent behavior
   - SSH terminals automatically set TERM (via `RequestPty()`) and receive server's LANG/LC_ALL
   - Local terminals need explicit environment variable setup to match

2. **TERM Variable Importance**: Controls terminal capabilities and control sequences
   - Basic TERM types (like `dumb` or `vt100`) lack delete key support
   - Modern TERM types (like `xterm-256color`) enable full terminal features

3. **UTF-8 Locale Requirement**: Multi-byte character support requires LANG/LC_ALL
   - Without UTF-8 locale, terminal treats multi-byte chars as separate bytes (garbled display)
   - With UTF-8 locale, terminal correctly handles character boundaries

4. **Configuration Documentation**: Critical settings must be documented in AGENTS.md
   - AI agents lack persistent memory across sessions
   - AGENTS.md serves as "permanent memory" for development best practices
   - Include WHY, not just WHAT - helps AI understand importance

5. **Vite Development Ergonomics**: Small configuration tweaks improve developer experience
   - Auto-opening browser is Vite's default but inappropriate for Wails apps
   - One-line fix eliminates repeated annoyance across all dev sessions

**Testing Verification:**

Local Terminal Tests (all pass âœ…):
1. Delete key: Press backspace - character deletes (not `^?` or `^H`)
2. Chinese input: Type "ä½ å¥½" - displays correctly (not garbled)
3. Terminal colors: Run `ls` - colors show correctly (256-color support)
4. Terminal resize: Resize window - terminal adapts (SIGWINCH works)
5. Parity check: Compare local vs SSH terminal behavior - identical

Development Workflow Test:
1. Run `wails dev` - app opens, browser does NOT open âœ…

---

## ğŸ”¥ Previous Update (2026-02-08)

### Version 2.33 - Terminal Improvements & Windows Support (2026-02-08)

**Critical Bug Fixes & Windows Support:**
- **Windows Local Terminal Support (CRITICAL)**: 
  - **Problem**: Local terminals completely broken on Windows - `creack/pty` library is Unix-only
  - **Solution**: Created platform-specific PTY implementations using build tags
    - `internal/app/pty_unix.go` (`//go:build !windows`) - Uses `creack/pty` for macOS/Linux
    - `internal/app/pty_windows.go` (`//go:build windows`) - Uses `github.com/UserExistsError/conpty` for Windows ConPTY API
  - **Shell Selection**: Windows defaults to COMSPEC (cmd.exe), then tries pwsh.exe â†’ powershell.exe â†’ cmd.exe
  - **Result**: Local terminals now work on Windows with native ConPTY support!

- **Linux Shell Fallback Bug Fix**:
  - **Problem**: Code always defaulted to `/bin/zsh` regardless of OS (comment said "bash on Linux" but code was wrong)
  - **Solution**: Added `runtime.GOOS` check - macOS â†’ `/bin/zsh`, Linux â†’ `/bin/bash`
  - **Location**: `internal/app/pty_unix.go:38-48`

- **Session Cleanup Leak Fix**:
  - **Problem**: Local terminal processes leaked when closing tabs (only SSH sessions were cleaned up)
  - **Solution**: Now calls `CloseTerminalSession()` for ALL session types (local + SSH)
  - **Location**: `frontend/src/components/terminal/TerminalTab.tsx:194-208`

- **stopChan Double-Close Panic Fix**:
  - **Problem**: Monitor goroutine and explicit close could race to close `stopChan`, causing panic
  - **Solution**: Added `sync.Once` (`stopOnce`) to guard channel closing
  - **Location**: `internal/app/terminal_handler.go:36` (struct field), used in 3 places

**Other Improvements:**

- **Session ID Collision Fix**: 
  - Changed from `time.Now().Unix()` (seconds) to `time.Now().UnixNano()` (nanoseconds)
  - Prevents duplicate IDs from rapid clicks within same second
  - Location: `internal/app/app.go:59`

- **Dead Code Cleanup**:
  - Removed unused `WebSocket *websocket.Conn` field from `TerminalSession` struct
  - Removed `github.com/gorilla/websocket` import and dependency
  - Deleted dead file: `frontend/src/components/session/SessionView.tsx` (never imported)
  - Renamed: `websocket_handler.go` â†’ `terminal_handler.go` (more accurate name, no WebSockets used)
  - Removed `TerminalMessage` struct (unused, legacy from WebSocket design)

- **Path Injection Fix**:
  - **Problem**: Sent `cd "{path}"\n` command after timeout - fragile and vulnerable to path injection
  - **Solution**: Added `initialDir` parameter to `StartLocalTerminalSession()`, sets `cmd.Dir` directly
  - **Benefit**: Safer, no injection risk, no timing issues
  - Locations: Backend `internal/app/pty_unix.go:18`, `pty_windows.go:28`; Frontend `Terminal.tsx:11`

- **Disconnection Notification**:
  - Backend emits `terminal:disconnected` event when session ends
  - Terminal shows red message: `[Session disconnected: Process exited]`
  - TerminalTab updates session status (turns tab dot red)
  - Locations: Backend `terminal_handler.go:180-186`, `pty_unix.go:157-163`; Frontend `Terminal.tsx:176-182`, `TerminalTab.tsx:60-74`

- **Windows/Linux Keyboard Fixes**:
  - Fixed platform detection (modern `navigator.userAgentData` with fallback)
  - Made `macOptionIsMeta` conditional (only true on macOS, was always true before)
  - Added Ctrl+Shift+C / Ctrl+Shift+V support (Linux/Windows terminal convention)
  - Location: `frontend/src/components/terminal/Terminal.tsx:189-323`

**Build System Enhancements:**
- Created `build-release.sh` - One-command release build script
- Output to `build/releases/` directory with version-tagged filenames
- Created documentation: `BUILD.md`, `docs/BUILD-RELEASE.md`, `docs/VERSION-RELEASE.md`
- Version number now read from `wails.json` (added `version: "2.33"` field)

**Files Changed:**

**Backend (Go):**
- `internal/app/terminal_handler.go` - Shared terminal logic (SSH + common functions)
- `internal/app/pty_unix.go` - **NEW**: Unix PTY implementation (macOS/Linux)
- `internal/app/pty_windows.go` - **NEW**: Windows ConPTY implementation
- `internal/app/app.go` - Session ID generation fix (Unix â†’ UnixNano)
- Deleted: `internal/app/websocket_handler.go` (renamed to terminal_handler.go)

**Frontend (TypeScript/React):**
- `frontend/src/components/terminal/Terminal.tsx` - Keyboard fixes, initialDir support, disconnect handling
- `frontend/src/components/terminal/TerminalTab.tsx` - Session cleanup, disconnect listener, initialDir passing
- Deleted: `frontend/src/components/session/SessionView.tsx` (dead code)

**Build & Documentation:**
- `build-release.sh` - **NEW**: Automated release build script
- `BUILD.md` - **NEW**: Quick reference guide
- `docs/BUILD-RELEASE.md` - **NEW**: Detailed build guide
- `docs/VERSION-RELEASE.md` - **NEW**: Version numbering & release process
- `wails.json` - Added `version: "2.33"` field
- `README.md` - Added v2.33 changelog, build documentation section

**Dependencies:**
- Added: `github.com/UserExistsError/conpty` v0.1.4 (Windows ConPTY support)
- Removed: `github.com/gorilla/websocket` (unused dead code)

**Key Lessons:**
1. **Platform-Specific Code**: Use build tags (`//go:build windows` / `//go:build !windows`) to separate platform implementations
2. **Cross-Platform PTY**: Unix uses `creack/pty`, Windows needs ConPTY API - no single library works for both
3. **Resource Management**: Always clean up sessions for ALL types, not just one (leaked local terminals)
4. **Channel Closing**: Use `sync.Once` for channels that might be closed from multiple goroutines
5. **Time Precision**: Use `UnixNano()` for unique IDs, not `Unix()` (seconds are too coarse)
6. **Security**: Never send shell commands with user input - use API parameters (cmd.Dir vs `cd` command)
7. **Dead Code Detection**: Remove unused fields/imports aggressively - they add confusion and dependencies

---

### Version 2.32 - Internationalization (i18n) Support (2026-02-08)

**New Features:**
- **Full i18n Support**: Complete internationalization system using react-i18next
  - Support for English (en-US) and Simplified Chinese (zh-CN)
  - 158+ UI strings translated across 7 namespace modules
  - Real-time language switching without app restart
  - User preference persists across sessions (saved to `settings.json`)
- **Settings Tab**: New centralized settings page
  - Language selector with dropdown (English / ç®€ä½“ä¸­æ–‡)
  - Terminal preferences (select-to-copy, right-click-paste)
  - Save button with success/failure toast notifications
- **Ant Design Internationalization**: Seamless integration with Ant Design components
  - Date pickers, table pagination, modals auto-sync with selected language
  - ConfigProvider wraps app with dynamic locale switching
- **Parameterized Translations**: Support for variable interpolation
  - Example: `t('connectedToHost', { host: 'server1' })` â†’ "Connected to server1" / "å·²è¿æ¥åˆ° server1"
  - Error messages, success toasts all use parameterized translations

**Technical Implementation:**
- **Backend (Go):**
  - Extended `TerminalSettings` struct with `Locale` field (`internal/app/app.go`)
  - Default locale set to `en-US`, automatically saved/loaded from user config
- **Frontend (React + TypeScript):**
  - Created i18n initialization config (`frontend/src/i18n/index.ts`)
  - Async loading of user locale from backend via `GetTerminalSettings()`
  - 7 namespace modules: common, terminal, editor, files, sync, tools, settings
  - 14 language pack JSON files (7 modules Ã— 2 languages)
- **Language Packs:**
  - `common.json`: 30 keys (save, cancel, delete, loading, etc.)
  - `terminal.json`: 25 keys (connection status, upload/download progress)
  - `editor.json`: 17 keys (file operations, unsaved changes)
  - `files.json`: 40 keys (file manager, context menu, dialogs)
  - `sync.json`: 35 keys (sync status, help documentation)
  - `tools.json`: 3 keys (tool names)
  - `settings.json`: 8 keys (settings page labels)

**Component Refactoring:**
All 10 major components refactored to use `useTranslation` hook:
1. **App.tsx**: Tab labels (Terminal, Tools, Editor, Sync, Files, Settings)
2. **ToolsTab.tsx**: Tool names (JSON Formatter, C Formatter, Escape Tool)
3. **EditorTab.tsx**: Buttons, dialogs, toast messages (~17 strings)
4. **TerminalTab.tsx**: Search box, buttons, connection status (~25 strings)
5. **SessionView.tsx**: Connection UI, retry/close buttons (~13 strings)
6. **FileManager.tsx**: Path editor, context menu, delete dialog (~20 strings)
7. **LocalFileManager.tsx**: Similar to FileManager (~20 strings)
8. **FilesTab.tsx**: Toolbar buttons, tab management (~15 strings)
9. **SyncPanel.tsx**: Most complex - status, form labels, help docs (~35 strings)
10. **SettingsTab.tsx**: New component - language selector, terminal settings (~8 strings)

**Files Changed:**
- **Backend (1 file):**
  - `internal/app/app.go` - Added `Locale string` field to `TerminalSettings` struct, default `"en-US"`
- **Frontend (17 new files + 10 modified):**
  - **New i18n infrastructure:**
    - `frontend/src/i18n/index.ts` - i18n initialization and config
    - `frontend/src/i18n/locales/en-US/` - 7 English language pack JSON files
    - `frontend/src/i18n/locales/zh-CN/` - 7 Chinese language pack JSON files
  - **New Settings component:**
    - `frontend/src/components/settings/SettingsTab.tsx` - Settings page component
    - `frontend/src/components/settings/SettingsTab.css` - Settings page styles
  - **Modified components:**
    - `frontend/src/main.tsx` - Wrapped app with i18n provider, integrated Ant Design locale
    - `frontend/src/App.tsx` - Added Settings tab, imported useTranslation
    - 8 component files refactored with `useTranslation` hook (ToolsTab, EditorTab, TerminalTab, SessionView, FileManager, LocalFileManager, FilesTab, SyncPanel)
- **Dependencies:**
  - Added `i18next` and `react-i18next` to `package.json`

**Key Lessons:**
- **Language Pack Organization**: Splitting translations into 7 namespaces keeps files manageable and enables lazy loading
- **Ant Design Integration**: Must manually sync `ConfigProvider` locale with i18next language changes (not automatic)
- **Backend Settings Storage**: Using JSON serialization for user settings allows easy extension (added `Locale` field without breaking existing settings)
- **Real-time Switching**: i18next supports instant language switching via `i18n.changeLanguage()` without page reload
- **Parameterized Messages**: Always use parameterized translations for dynamic content (e.g., file names, error messages) to support word order differences between languages
- **Component Refactoring Pattern**: Import `useTranslation`, call `const { t } = useTranslation(['namespace1', 'namespace2'])`, replace all hard-coded strings with `t('key')` calls
- **Settings Page Benefits**: Centralizing all app preferences in one tab improves UX and makes future additions easier

**Development Stats:**
- Total implementation time: ~4 hours (including testing)
- Lines of code changed: +437 insertions, -228 deletions
- Number of translated strings: 158+
- Number of refactored components: 10
- Build size increase: ~100KB (i18next + language packs)

---

## Previous Updates

### Version 2.31 - File Association & Open With (2026-02-08)

**New Features:**
- **File Association**: Registered 38+ file types in `wails.json` via `info.fileAssociations`
  - Text/Config: txt, md, json, yaml, yml, toml, xml, csv, log, conf, cfg, ini, env
  - Scripts: sh, bash, zsh
  - Source code: go, py, js, ts, jsx, tsx, html, css, scss, less, sql, rs, c, h, cpp, java, rb, php, swift, kt, lua, dockerfile
  - Wails auto-generates `CFBundleDocumentTypes` in `Info.plist` (macOS) and NSIS registry entries (Windows)
- **macOS OnFileOpen**: Added `mac.Options.OnFileOpen` callback in `main.go`
  - Queue mechanism with `sync.Mutex`: files opened before `Startup` are buffered, processed after app is ready
  - Opens in native NSWindow + WKWebView via `OpenEditorWindow`
- **Windows File Args**: Parses `os.Args[1:]` for file paths passed by Windows file association
  - Skips flags (args starting with `-`)
  - Emits `editor:open-file` Wails event to notify frontend
- **Frontend Event Chain**: `editor:open-file` (Wails) -> `App.tsx` switches to editor tab -> `app:open-file-in-editor` (DOM CustomEvent) -> `EditorTab.tsx` calls `openFileFromPath()`

**Files Changed:**
- **Backend**: `main.go` (OnFileOpen, queue, Windows args, EventsEmit), `wails.json` (fileAssociations)
- **Frontend**: `frontend/src/App.tsx` (EventsOn editor:open-file), `frontend/src/components/editor/EditorTab.tsx` (app:open-file-in-editor listener)

**Key Lessons:**
- Wails `mac.Options.OnFileOpen` signature is `func(filePath string)`, not `func(filePaths []string)` as shown in some docs
- `OnFileOpen` can fire before `Startup` on macOS â€” must buffer files and process after app context is ready
- Windows file association doesn't use `OnFileOpen` â€” it passes file paths as command-line arguments
- On Windows, using Wails EventsEmit to open files in main window EditorTab is more practical than creating native WebView2 windows (which would conflict with Wails' message loop)

---

## Previous Updates

### Version 2.30 - Local File Browser (2026-02-08)

**New Features:**
- **Files Tab**: New main tab with full local file browser, multi-tab support
  - Windows-style navigation: back/forward/up buttons with history tracking
  - Breadcrumb path bar (click to jump, click to edit as input)
  - File list: icon, name, date, size columns; sort dirs first
  - Status bar: item count + full path
- **Finder Drag-and-Drop**: Drag files/folders from macOS Finder into Files tab to open
  - Requires `--wails-drop-target: drop` CSS property on container
- **File Operations**: copy/cut/paste (cross-tab clipboard via Go backend), rename, delete, new file/folder
- **Terminal Integration**: toolbar button opens local terminal `cd`-ed to current directory
- **Pop-out Window**: drag tab out (>100px) to open in native NSWindow via `editor_server.go`
- **Enter to Rename**: Added Enter key shortcut for rename (F2 doesn't work on macOS)

**Bug Fixes:**
- **TDZ Error**: `useEffect` referenced `openNewTab` before its `const` declaration â€” fatal in minified builds ("Cannot access 'u' before initialization"). Fixed by reordering declarations.
- **+ Button Single Use**: `openNewTab` deduplicated by path, so clicking + twice with Home was a no-op. Split into `createTab` (always creates) for both + button and Finder drops.
- **Finder Drop Silent Fail**: `FilesTab.css` missing `--wails-drop-target: drop;`. Wails requires this CSS custom property to register drop targets.

**Files Changed:**
- **Backend**: `internal/app/file_operations.go` (new), `internal/app/editor_server.go` (file browser window)
- **Frontend**: `frontend/src/components/files/FilesTab.tsx` (new), `frontend/src/components/files/FileBrowserPanel.tsx` (new), `frontend/src/components/files/FilesTab.css` (new), `frontend/src/components/files/FileBrowserPanel.css` (new), `frontend/src/App.tsx` (added Files tab + drop dispatch)
- **Documentation**: `README.md`, `docs/å·¥ç¨‹æ€»ç»“.md`, `REQUIREMENTS.md`

**Key Lessons:**
- Wails file drop requires `--wails-drop-target: drop` CSS property â€” easy to forget for new components
- JavaScript `const` has TDZ â€” `useEffect` dependency on a later-declared `const` works in dev (hoisted by bundler) but crashes in production minified builds
- React `setTabs` callback is async â€” don't rely on variables set inside it being available synchronously after

---

## Previous Updates

### Version 2.28 - Build Process & Paste Fix (2026-02-08)

**Build Process Documentation:**
- **Production Build Steps**: Documented mandatory cache-cleaning steps before every build
  - Must clean `frontend/dist/assets` and Vite cache (`node_modules/.vite`, `.vite`)
  - Must use `wails build -clean` flag to clear `build/bin/`
  - Must kill old process before opening (`pkill -f xterm-file-manager`) â€” macOS reuses running instances
  - `build/bin/*` can be safely deleted (only build artifacts)
  - `frontend/dist/` directory itself must NOT be deleted (contains `gitkeep` for Go `//go:embed`)
- **One-liner Build Command**: Added to README.md for quick copy-paste workflow
  ```bash
  rm -rf build/bin/* frontend/dist/assets && cd frontend && rm -rf node_modules/.vite .vite && cd .. && wails build -platform darwin/arm64 -clean && pkill -f xterm-file-manager 2>/dev/null; sleep 1; open build/bin/xterm-file-manager.app
  ```

**Bug Fixes:**
- **Terminal Paste Reverted to v2.25**: The fa160a37 commit changed paste to "as-is without modification", which broke multiline paste behavior. Reverted to v2.25 version:
  - Multiline paste uses bracketed paste mode (`\x1b[200~` ... `\x1b[201~`) for proper shell handling
  - Single-line paste strips trailing newlines to prevent auto-execution
  - Both keyboard paste (Cmd+V/Ctrl+V) and right-click paste use consistent logic
- **Ctrl+V Exclusion Restored**: Re-added `!isKey(event, 'v', 'KeyV')` to macOS Ctrl passthrough rule (line 316-318 in Terminal.tsx)

**Key Lessons:**
- Stale Vite cache is the #1 cause of "code changes not taking effect" â€” always clean before build
- macOS `open` command reuses running app instances â€” must `pkill` first to launch new build
- `-clean` flag on `wails build` is essential to avoid leftover old binaries
- Terminal paste handling is fragile â€” bracketed paste mode works for shell, but breaks vim; current compromise keeps bracketed paste for multiline only

**Files Changed:**
- **Frontend**: `frontend/src/components/terminal/Terminal.tsx` (reverted paste handling to v2.25)
- **Documentation**: `README.md` (build steps, one-liner, v2.28 changelog), `docs/å·¥ç¨‹æ€»ç»“.md` (this entry)

---

## Previous Updates

### Version 2.27 - Security & Performance Improvements (2026-02-07/08)

**Security Enhancements:**
- **SSH Host Key Verification**: Implemented TOFU (Trust On First Use) strategy
  - Verifies host keys against `~/.ssh/known_hosts` (`ssh_manager.go:knownHostsCallback`)
  - Auto-trusts new hosts and appends fingerprint to known_hosts
  - Detects and blocks key mismatch attacks (prevents MITM)
  - SHA256 fingerprint logging: `log.Printf("ğŸ” New host key for %s (SHA256:%s)")` (`ssh_manager.go:72`)
- **Fixed JSON marshal error handling**: Added explicit error checks in `app.go:95,113` (prevents silent failures)
- **Fixed EOF error comparison**: Changed `err.Error() == "EOF"` to `err == io.EOF` in `app.go:369` (proper type checking)

**Performance Optimizations:**
- **SFTP Connection Pool**: Reuses SFTP connections instead of creating/destroying per operation
  - Added `sftpPool` map with mutex (`local_files.go:87-96`)
  - `getSFTPClient()` now caches clients per session with health checks (`local_files.go:99-133`)
  - `closeSFTPClient()` for cleanup when SSH session disconnects (`local_files.go:136-142`)
  - Removed all `defer sftpClient.Close()` calls in file operation functions
- **Removed excessive terminal output logging**: Deleted `log.Printf("Terminal output [%s]: %d bytes")` in `websocket_handler.go:427` (eliminates per-byte logging overhead)
- **Extracted magic numbers to named constants**: Added `IOBufferSize=32KB`, `SSHConnectTimeout=10s`, `MaxUntitledFiles=1000` (`app.go:16-25`)

**Bug Fixes:**
- **Debug log path**: Changed from shared `/tmp/xterm-file-manager-debug.log` to user-specific directory
  - macOS: `~/Library/Logs/xterm-file-manager/debug.log`
  - Linux: `~/.cache/xterm-file-manager/debug.log`
  - Added `getDebugLogPath()` function with platform detection (`app.go:139-151`)
  - Updated logger.ts documentation (`logger.ts:2-5`)
- **Added missing RenameLocalFile and RenameRemoteFile backend methods**: `local_files.go:432-456` (frontend F2 rename now works)
- **Deprecated CreatePTY method**: Returns error message recommending `StartTerminalSession` (`ssh_manager.go:375-377`) to prevent goroutine leak
- **Frontend type imports cleanup**: Replaced `(window as any).go.app.App.*` with explicit Wails imports in `LocalFileManager.tsx:13`, `TerminalTab.tsx:6`

**Files Changed:**
- **Backend**: `internal/app/app.go` (constants, error handling, debug log path), `internal/app/ssh_manager.go` (TOFU host key verification), `internal/app/local_files.go` (SFTP connection pool), `internal/app/websocket_handler.go` (remove excessive logging)
- **Frontend**: `frontend/src/components/file-manager/LocalFileManager.tsx` (Wails imports), `frontend/src/components/terminal/TerminalTab.tsx` (Wails imports), `frontend/src/utils/logger.ts` (doc update), `frontend/wailsjs/go/app/App.d.ts` (auto-generated bindings), `frontend/wailsjs/go/app/App.js` (auto-generated bindings)
- **Config**: `build/bin/xterm-file-manager.app/Contents/Info.plist` (NSAllowsLocalNetworking for editor HTTP server)
- **Documentation**: `AGENTS.md` (new file - developer guide for AI agents), `README.md` (v2.27 changelog)

**AGENTS.md - New File:**
- Added comprehensive developer guide for AI coding agents
- Includes project overview, build commands, code style guidelines
- Documents Go and TypeScript naming conventions, error handling patterns
- Lists common patterns, important notes, and key conventions
- This file helps AI understand the codebase structure and best practices

**Key Lessons:**
- SFTP connection creation is expensive (network handshake + auth), pooling dramatically improves performance for repeated file operations
- Host key verification is critical for SSH security - TOFU prevents silent MITM attacks
- Debug logs should go to user-specific directories, not shared `/tmp` (security + multi-user support)
- EOF should be compared using `err == io.EOF`, not string comparison (type safety)
- Excessive logging kills performance - log high-level events, not per-byte I/O
- Named constants improve code readability and maintainability (better than magic numbers)

---

### Version 2.27 - Terminal Input Fix (Backspace & Paste) (2026-02-07)

**Bug Fixed**: Backspace key not working, vim paste incomplete

**Root Cause:**
1. **Backspace issue**: Ctrl+V was not excluded from macOS Ctrl passthrough rule, potentially interfering with key processing
2. **Vim paste issue**: Bracketed paste mode (`\x1b[200~` ... `\x1b[201~`) caused problems in vim:
   - Vim doesn't recognize bracketed paste by default (needs `:set paste` mode)
   - Content trimming removed trailing characters, causing incomplete paste

**Fix:**
1. **Backspace**: Exclude Ctrl+V from macOS Ctrl passthrough rule (line 316-318 in Terminal.tsx)
2. **Paste**: Remove bracketed paste mode, paste content as-is without modification
   - Keyboard paste (Cmd+V/Ctrl+V): Direct paste, no escape sequences (line 276-291)
   - Right-click paste: Direct paste, no trim operation (line 326-340)
   - Remove bracketed paste comment in xterm config (line 128-131)

**Key Lessons:**
- Bracketed paste mode breaks vim - vim needs raw input for paste to work correctly
- xterm.js default behavior handles Backspace correctly - don't interfere with Ctrl key processing
- Keep paste simple: pass content as-is, let shell/vim handle it

**Files Changed:**
- `frontend/src/components/terminal/Terminal.tsx` (lines 128-131, 276-291, 316-340)

---

### Version 2.26 - Terminal Drag & Drop Support

**åŠŸèƒ½**ï¼šåœ¨ Terminal ç•Œé¢æ”¯æŒæ‹–æ‹½æ–‡ä»¶ï¼Œè‡ªåŠ¨å°†æ–‡ä»¶ç»å¯¹è·¯å¾„æ’å…¥åˆ°ç»ˆç«¯ã€‚

**å…³é”®æŠ€æœ¯ç‚¹ - Wails æ‹–æ‹½æœ€ä½³å®è·µï¼š**

1. **å…¨å±€ OnFileDrop ç®¡ç†**ï¼š
   - Wails çš„ `OnFileDrop` æ˜¯**å…¨å±€å”¯ä¸€å›è°ƒ**ï¼Œåªèƒ½æ³¨å†Œä¸€æ¬¡
   - åœ¨ App.tsx ç»Ÿä¸€æ³¨å†Œï¼Œæ ¹æ®æ´»åŠ¨ tab é€šè¿‡ `CustomEvent` åˆ†å‘

2. **â­ CSS Drop Target æ ‡è®°** - **æ ¸å¿ƒå…³é”®ç‚¹**ï¼š
   - **å¿…é¡»åœ¨ CSS ä¸­æ·»åŠ  `--wails-drop-target: drop` å±æ€§**
   - `OnFileDrop(callback, true)` ç¬¬äºŒä¸ªå‚æ•° `true` è¡¨ç¤ºåªå“åº”å¸¦æ­¤å±æ€§çš„å…ƒç´ 
   - **æ²¡æœ‰æ­¤å±æ€§ï¼Œ`OnFileDrop` ä¸ä¼šè¢«è§¦å‘** âŒ
   - ç¤ºä¾‹ï¼š
     ```css
     .terminal-content { --wails-drop-target: drop; }
     .editor-tab-container { --wails-drop-target: drop; }
     ```

3. **Wails OnFileDrop æ‹¦æˆªæµè§ˆå™¨äº‹ä»¶**ï¼š
   - Wails OnFileDrop ä¼šæ‹¦æˆªæµè§ˆå™¨åŸç”Ÿ onDrop äº‹ä»¶
   - éœ€è¦æ‰‹åŠ¨åˆ†å‘ `app:clear-drag-state` äº‹ä»¶æ¸…é™¤æ‹–æ‹½çŠ¶æ€

**Files Changed:**
- `App.tsx` - å…¨å±€ OnFileDrop ç®¡ç†å’Œäº‹ä»¶åˆ†å‘
- `TerminalTab.tsx` / `TerminalTab.css` - æ‹–æ‹½è§†è§‰åé¦ˆ + `--wails-drop-target`
- `Terminal.tsx` - æ¥æ”¶æ–‡ä»¶è·¯å¾„å¹¶å†™å…¥ç»ˆç«¯
- `EditorTab.tsx` - æ”¹ç”¨è‡ªå®šä¹‰äº‹ä»¶æ¥æ”¶æ–‡ä»¶è·¯å¾„

---

## ğŸ“‹ Quick Reference for AI

### Project Overview
- **Type**: SSH Terminal File Manager Desktop Application
- **Tech Stack**: Go + Wails v2 (Backend) | React + TypeScript + Ant Design + XTerm.js (Frontend)
- **Platform**: macOS (primary), cross-platform support
- **Current Version**: 2.28

### Key Architecture
- **Backend**: Go with Wails v2 framework, SSH/SFTP via `golang.org/x/crypto/ssh` and `github.com/pkg/sftp`
- **Frontend**: React SPA with TypeScript, Ant Design UI, XTerm.js terminal emulator
- **Communication**: Wails runtime events (`EventsEmit`/`EventsOn`) for real-time terminal I/O
- **Settings**: JSON file in `~/Library/Application Support/xterm-file-manager/settings.json`

### Core Features
1. **SSH Terminal**: Full PTY terminal with real-time I/O (SSH and local sessions)
2. **File Management**: Three-pane layout (Terminal | Remote Files | Local Files) with SFTP transfers
3. **Terminal Features**: Select-to-copy, right-click-paste (MobaXterm-like behavior)
4. **Tools Tab**: JSON Formatter, C Formatter, Escape Tool
5. **Editor Tab**: Multi-tab file editor with drag-and-drop support (Notepad++-like)
6. **Session Management**: Multi-tab interface with connection status indicators

### Key Files
- **Backend**: `main.go` (entry), `internal/app/app.go` (settings/API/file ops), `internal/app/websocket_handler.go` (terminal I/O), `internal/app/ssh_manager.go` (SSH connections), `internal/app/ssh.go` (SSH config parser), `internal/app/local_files.go` (SFTP operations)
- **Frontend**: `App.tsx` (main), `TerminalTab.tsx` (terminal UI), `Terminal.tsx` (xterm component), `EditorTab.tsx` (file editor)
- **Config**: `wails.json`, `go.mod`, `frontend/package.json`

### Recent Changes (v2.22)
- **Editor Tab**: New multi-tab file editor with drag-and-drop support
- Default save directory: `~/Documents/XTermFileManager/`
- Auto-naming: Untitled.txt, Untitled-1.txt, etc.
- Monaco Editor integration with 30+ language support
- Tab label optimization: filename truncation with ellipsis + full path tooltip

---

## âœ… Latest Updates (2026-02-06)

### Version 2.22.1 - Editor Tab UI Optimization (2026-02-06)

**ç›®æ ‡**ï¼šä¼˜åŒ–ç¼–è¾‘å™¨ Tab çš„ç”¨æˆ·ä½“éªŒï¼Œæ”¯æŒé•¿æ–‡ä»¶åæ˜¾ç¤ºå’Œå¤š Tab ç®¡ç†ã€‚

**UI æ”¹è¿›ï¼š**
- âœ… Tab æ–‡ä»¶åæ™ºèƒ½æˆªæ–­ï¼šè¶…é•¿æ–‡ä»¶åè‡ªåŠ¨çœç•¥ï¼ˆ`max-width: 120px`ï¼‰
- âœ… å®Œæ•´è·¯å¾„æ‚¬åœæç¤ºï¼šé¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ–‡ä»¶å®Œæ•´è·¯å¾„ï¼ˆ`title` å±æ€§ï¼‰
- âœ… æ‹–æ‹½è¦†ç›–å±‚ä¼˜åŒ–ï¼šä¿®å¤æ‹–æ‹½åè¦†ç›–å±‚ä¸æ¶ˆå¤±çš„é—®é¢˜
  - åœ¨ `main.go` å¯ç”¨ `DragAndDrop: true`
  - åœ¨ `OnFileDrop` å›è°ƒä¸­ç«‹å³æ¸…é™¤ `isDragging` çŠ¶æ€
  - æ·»åŠ  3 ç§’å®‰å…¨è¶…æ—¶è‡ªåŠ¨æ¸…é™¤è¦†ç›–å±‚

**é—®é¢˜ä¿®å¤ï¼š**
- ğŸ› æ‹–æ‹½æ–‡ä»¶åè¦†ç›–å±‚é®æŒ¡ç¼–è¾‘å™¨å†…å®¹
  - åŸå› ï¼š`DisableWebViewDrop: true` å¯¼è‡´æµè§ˆå™¨ `onDrop` äº‹ä»¶æ— æ³•è§¦å‘
  - è§£å†³ï¼šæ”¹ç”¨ Wails åŸç”Ÿ `OnFileDrop` API + åœ¨å›è°ƒä¸­æ‰‹åŠ¨æ¸…é™¤çŠ¶æ€
- ğŸ› æ‹–æ‹½æ—¶ä»…è·å–æ–‡ä»¶åè€Œéå®Œæ•´è·¯å¾„
  - åŸå› ï¼šHTML5 `e.dataTransfer.files[i].path` åœ¨ Wails WebView ä¸­è¿”å›ä¸å®Œæ•´
  - è§£å†³ï¼šå®Œå…¨åˆ‡æ¢åˆ° Wails åŸç”Ÿ `runtime.OnFileDrop`ï¼Œè·å–å®Œæ•´ç»å¯¹è·¯å¾„

**æŠ€æœ¯ç»†èŠ‚ï¼š**
- CSS ä¼˜åŒ–ï¼š`text-overflow: ellipsis` + `white-space: nowrap` + `overflow: hidden`
- äº‹ä»¶ç›‘å¬å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š`useEffect` cleanup è°ƒç”¨ `OnFileDropOff()`
- é˜²æŠ–ä¿æŠ¤ï¼š`dragTimeoutRef` é˜²æ­¢è¦†ç›–å±‚çŠ¶æ€å¼‚å¸¸

**Files Changed:**
- Frontend: `frontend/src/components/editor/EditorTab.tsx` (UI logic)
- Frontend: `frontend/src/components/editor/EditorTab.css` (tab label styles)
- Backend: `main.go` (enable DragAndDrop)

---

### Version 2.22 - Editor Tab Feature (2026-02-06)

**ç›®æ ‡**ï¼šæ–°å¢ç‹¬ç«‹çš„æ–‡ä»¶ç¼–è¾‘å™¨ Tabï¼Œæä¾›ç±»ä¼¼ Notepad++ çš„å¤šæ ‡ç­¾æ–‡ä»¶ç¼–è¾‘èƒ½åŠ›ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… å¤šæ ‡ç­¾æ–‡ä»¶ç¼–è¾‘ç•Œé¢ï¼Œå¯åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶
- âœ… æ‹–æ‹½ç³»ç»Ÿæ–‡ä»¶åˆ°ç¼–è¾‘å™¨æ‰“å¼€
- âœ… æ–°å»ºæ–‡ä»¶æŒ‰é’® (+)ï¼Œåˆ›å»ºç©ºç™½æ–‡ä»¶
- âœ… ä¿å­˜åŠŸèƒ½ï¼Œæ”¯æŒ Cmd+S å¿«æ·é”®
- âœ… æœªä¿å­˜æ›´æ”¹æç¤ºï¼ˆç»¿ç‚¹æ ‡è¯†ï¼‰
- âœ… å…³é—­æ ‡ç­¾æ—¶æ£€æŸ¥æœªä¿å­˜æ›´æ”¹
- âœ… é»˜è®¤ä¿å­˜è·¯å¾„ï¼š`~/Documents/XTermFileManager/`
- âœ… è‡ªåŠ¨æ–‡ä»¶å‘½åï¼šUntitled.txt, Untitled-1.txt, Untitled-2.txt...

**åç«¯ API æ–°å¢ï¼š**
- `CreateLocalFile(filePath string)` - åˆ›å»ºç©ºæ–‡ä»¶
- `GetDefaultEditorDirectory()` - è·å–é»˜è®¤ç¼–è¾‘å™¨ç›®å½•
- `GetNextUntitledFileName(directory string)` - è·å–ä¸‹ä¸€ä¸ªå¯ç”¨çš„ Untitled-N.txt æ–‡ä»¶å

**å‰ç«¯ç»„ä»¶ï¼š**
- `frontend/src/components/editor/EditorTab.tsx` - ä¸»ç¼–è¾‘å™¨ç»„ä»¶
- `frontend/src/components/editor/EditorTab.css` - ç¼–è¾‘å™¨æ ·å¼
- é›†æˆåˆ° `App.tsx` ä½œä¸ºç¬¬ä¸‰ä¸ªä¸» Tabï¼ˆTerminal | Tools | Editorï¼‰

**æŠ€æœ¯å®ç°ï¼š**
- Monaco Editor é›†æˆï¼ˆå¤ç”¨ç°æœ‰ `@monaco-editor/react`ï¼‰
- è¯­æ³•é«˜äº®æ”¯æŒ 30+ ç¼–ç¨‹è¯­è¨€
- HTML5 Drag & Drop API å®ç°æ‹–æ‹½æ‰“å¼€
- è·¨å¹³å°é»˜è®¤ç›®å½•ï¼ˆmacOS/Windows Documents ç›®å½•ï¼‰

**Files Changed:**
- Backend: `internal/app/app.go` (+3 APIs)
- Frontend: `frontend/src/components/editor/EditorTab.tsx` (new), `EditorTab.css` (new)
- Integration: `frontend/src/App.tsx` (add Editor tab)

---

### Documentation Update (2026-02-06)

**ç›®æ ‡**ï¼šæ›´æ–°æ–‡æ¡£ä»¥å‡†ç¡®åæ˜  v2.21 çš„é¡¹ç›®ç»“æ„å˜åŒ–ã€‚

**æ›´æ–°å†…å®¹ï¼š**
- âœ… ä¿®æ­£ v2.21 ç‰ˆæœ¬æè¿°ï¼Œå‡†ç¡®åæ˜ å®é™…çš„é¡¹ç›®ç»“æ„ï¼ˆGo ä»£ç ç§»åŠ¨åˆ° `internal/app/`ï¼‰
- âœ… æ›´æ–°æ‰€æœ‰æ–‡æ¡£ä¸­çš„æ–‡ä»¶è·¯å¾„å¼•ç”¨ï¼ˆä»æ ¹ç›®å½•æ–‡ä»¶æ”¹ä¸º `internal/app/` è·¯å¾„ï¼‰
- âœ… ç»Ÿä¸€é¡¹ç›®ç»“æ„è¯´æ˜ï¼Œç¡®ä¿æ–‡æ¡£ä¸€è‡´æ€§
- âœ… æ›´æ–° Wails ç»‘å®šè·¯å¾„è¯´æ˜ï¼ˆ`frontend/wailsjs/go/app/`ï¼‰

**æ›´æ–°çš„æ–‡æ¡£ï¼š**
- `docs/å·¥ç¨‹æ€»ç»“.md` - ä¿®æ­£äº† 20+ å¤„æ–‡ä»¶è·¯å¾„å¼•ç”¨
- `docs/QUICKSTART.md` - æ›´æ–°é¡¹ç›®ç»“æ„è¯´æ˜
- `docs/IMPLEMENTATION_SUMMARY.md` - ä¿®æ­£æ–‡ä»¶è·¯å¾„å¼•ç”¨
- `README.md` - é¡¹ç›®ç»“æ„éƒ¨åˆ†å·²æ˜¯æœ€æ–°

**å…³é”®ä¿®æ­£ï¼š**
- åŸæ–‡æ¡£æè¿°æ–‡ä»¶è¢«é‡å‘½åï¼ˆå¦‚ `websocket_handler.go` â†’ `terminal.go`ï¼‰ï¼Œä½†å®é™…åªæ˜¯ç§»åŠ¨åˆ° `internal/app/` ç›®å½•
- å®é™…æ–‡ä»¶åä¿æŒä¸å˜ï¼š`app.go`, `ssh.go`, `ssh_manager.go`, `websocket_handler.go`, `local_files.go`
- Package åä» `main` æ”¹ä¸º `app`

---

### Version 2.21 - Project Structure Reorganization

**ç›®æ ‡**ï¼šé‡ç»„é¡¹ç›®ç»“æ„ï¼Œç¬¦åˆ Go ç¤¾åŒºæœ€ä½³å®è·µï¼Œæé«˜ä»£ç ç»„ç»‡æ€§ã€‚

**Go ä»£ç é‡ç»„ï¼š**
- æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ä»£ç ç§»è‡³ `internal/app/` åŒ…
- `main.go` åªä¿ç•™åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œè´Ÿè´£åº”ç”¨åˆå§‹åŒ–
- é‡‡ç”¨æ ‡å‡† Go é¡¹ç›®å¸ƒå±€ï¼Œä½¿ç”¨ `internal/` ç›®å½•ä¿æŠ¤å†…éƒ¨åŒ…
- Package åä» `main` æ”¹ä¸º `app`ï¼Œæ›´æ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„

**æ–‡ä»¶ç»“æ„ï¼š**
```
xterm-file-manager/
â”œâ”€â”€ main.go                      # åº”ç”¨å…¥å£ï¼Œåˆå§‹åŒ–å’Œå¯åŠ¨
â””â”€â”€ internal/app/                # ä¸šåŠ¡é€»è¾‘åŒ… (package app)
    â”œâ”€â”€ app.go                   # App struct, è®¾ç½®ç®¡ç†, ç”Ÿå‘½å‘¨æœŸ
    â”œâ”€â”€ ssh.go                   # SSH é…ç½®è§£æ (~/.ssh/config)
    â”œâ”€â”€ ssh_manager.go           # SSH è¿æ¥æ± ç®¡ç†
    â”œâ”€â”€ websocket_handler.go     # Terminal PTY I/O (SSH + local)
    â””â”€â”€ local_files.go           # æ–‡ä»¶æ“ä½œ (æœ¬åœ° + SFTP)
```

**Wails ç»‘å®šæ›´æ–°ï¼š**
- å‰ç«¯ç»‘å®šè·¯å¾„ä» `frontend/wailsjs/go/main/` æ”¹ä¸º `frontend/wailsjs/go/app/`
- æ‰€æœ‰å‰ç«¯è°ƒç”¨è‡ªåŠ¨æ›´æ–°åˆ°æ–°çš„åŒ…è·¯å¾„

**ç›®å½•æ•´ç†ï¼š**
- `docs/`ï¼šåˆå¹¶æ ¹ç›®å½•æ•£è½çš„ md æ–‡ä»¶
- `scripts/`ï¼šæ–°å»ºç›®å½•ï¼Œæ”¶çº³é…ç½®å’Œæµ‹è¯•è„šæœ¬
- åˆ é™¤ç©ºç›®å½•ï¼š`frontend/src/store/`, `frontend/src/components/layout/`

**Files Changed:**
- Go: `main.go`, `internal/app/*.go` (5 ä¸ªæ–‡ä»¶)
- Wails bindings: `frontend/wailsjs/go/app/*` (è‡ªåŠ¨ç”Ÿæˆ)
- Docs: ç§»åŠ¨åˆ° `docs/` (5 ä¸ª md æ–‡ä»¶)
- Scripts: ç§»åŠ¨åˆ° `scripts/` (2 ä¸ªæ–‡ä»¶)

---

### Version 2.20 - Terminal Session Dedup & Tab-Switch Flicker Fix

**é—®é¢˜ 1ï¼šæ‰“å¼€ç»ˆç«¯å‡ºç°ä¸¤ä»½ç™»å½•æ—¥å¿—ï¼ˆduplicate PTYï¼‰**

ä¸‰å±‚åŸå› å¯¼è‡´åŒä¸€ä¸ª session åˆ›å»ºäº†ä¸¤ä¸ª PTYï¼š
1. å‰ç«¯ `handleCreateSession` æ— é˜²æŠ–ï¼Œå¿«é€Ÿç‚¹å‡»å¯è§¦å‘é‡å¤è¿æ¥
2. åç«¯ `ssh_manager.go` ç”¨ç§’çº§æ—¶é—´æˆ³ (`time.Now().Unix()`) ç”Ÿæˆ session IDï¼ŒåŒç§’å†…ç¢°æ’
3. åç«¯ `StartTerminalSession` ç”¨ `RLock` åšå­˜åœ¨æ£€æŸ¥ï¼Œä¸¤ä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶é€šè¿‡ï¼ˆTOCTOU ç«æ€ï¼‰

**ä¿®å¤ï¼ˆä¸‰å±‚é˜²å¾¡ï¼‰ï¼š**
- **å‰ç«¯** `TerminalTab.tsx`ï¼š`connectingHostsRef` (Set) é˜»æ­¢åŒä¸€ host é‡å¤å‘èµ·è¿æ¥
- **åç«¯** `ssh_manager.go`ï¼šsession ID æ”¹ç”¨çº³ç§’ç²¾åº¦ `time.Now().UnixNano()`
- **åç«¯** `websocket_handler.go`ï¼š`StartTerminalSession` / `StartLocalTerminalSession` æ”¹ç”¨ **å†™é”** (`termSessionMu.Lock()`)ï¼Œè·å–é”åç«‹å³æ”¾å ä½ç¬¦ `terminalSessions[sessionID] = nil`ï¼Œå½»åº•æ¶ˆé™¤ TOCTOU

**é—®é¢˜ 1.1ï¼šReact StrictMode åŒæŒ‚è½½ä»å¯¼è‡´é‡å¤**

StrictMode unmountâ†’remount æ—¶ cleanup å‡½æ•°é‡ç½®äº† `sessionStartedRef`ï¼Œå¯¼è‡´ guard å¤±æ•ˆã€‚

**ä¿®å¤**ï¼šcleanup ä¸­ **ä¸å†é‡ç½®** `sessionStartedRef.current = null`ï¼Œè®© ref è·¨ StrictMode å‘¨æœŸä¿ç•™ã€‚

**é—®é¢˜ 2ï¼šåˆ‡æ¢ç»ˆç«¯ Tab æ—¶ä¹‹å‰çš„ç»ˆç«¯"é—ªçƒ"ï¼ˆçœ‹èµ·æ¥é‡è¿äº†ï¼‰**

åŸå› ï¼šç”¨ `display: none` éšè—éæ´»è·ƒ tab â†’ å®¹å™¨å°ºå¯¸å˜ä¸º 0Ã—0 â†’ åˆ‡å›æ—¶ ResizeObserver è§¦å‘ `fit()` â†’ å‘é€ `ResizeTerminal` â†’ åç«¯ SIGWINCH â†’ shell é‡ç»˜ã€‚

**ä¿®å¤ï¼ˆå‚è€ƒ electerm é¡¹ç›® `session.styl`ï¼‰ï¼š**

| æ”¹åŠ¨ | æ–‡ä»¶ | è¦ç‚¹ |
|------|------|------|
| CSS | `TerminalTab.css` | éæ´»è·ƒ tab æ”¹ç”¨ `position: absolute; visibility: hidden; pointer-events: none`ï¼Œä¿æŒå®¹å™¨å°ºå¯¸ä¸å˜ |
| CSS | `TerminalTab.css` | æ´»è·ƒ tab åŠ  `.session-active { visibility: visible; pointer-events: auto }` |
| TSX | `TerminalTab.tsx` | æ¸²æŸ“æ—¶ç”¨ class `session-active` æ›¿ä»£ inline `display` æ ·å¼ï¼›ä¼  `isActive` prop ç»™ `Terminal` |
| TSX | `Terminal.tsx` | æ–°å¢ `isActive` prop + `isActiveRef`ï¼›`handleResize` å†… `if (!isActiveRef.current) return` è·³è¿‡éæ´»è·ƒ tab |
| TSX | `Terminal.tsx` | æ–°å¢ `lastDimensionsRef`ï¼Œä»…åœ¨å°ºå¯¸çœŸæ­£å˜åŒ–æ—¶æ‰å‘ `ResizeTerminal`ï¼Œé¿å…å†—ä½™ SIGWINCH |
| TSX | `Terminal.tsx` | tab å˜ä¸ºæ´»è·ƒæ—¶è‡ªåŠ¨ `focus()` + `handleResize()` è¡¥å¿éšè—æœŸé—´çš„çª—å£å¤§å°å˜åŒ– |

**é—®é¢˜ 3ï¼š`Cannot access 'handleResize' before initialization`**

`const` å£°æ˜çš„æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰â€”â€” `useEffect` å¼•ç”¨ `handleResize` çš„ä½ç½®åœ¨ `useCallback` å®šä¹‰ä¹‹å‰ã€‚

**ä¿®å¤**ï¼šå°† `isActive` åŒæ­¥çš„ `useEffect` ç§»åˆ° `handleResize = useCallback(...)` **ä¹‹å**ã€‚

**æ ¸å¿ƒç»éªŒï¼š**
- `display: none` ä¼šå¯¼è‡´ xterm å®¹å™¨å°ºå¯¸å½’é›¶ï¼Œåˆ‡å›æ—¶è§¦å‘ resize é£æš´ â†’ ç”¨ `visibility: hidden` + ç»å¯¹å®šä½ä¿æŒå°ºå¯¸
- åç«¯é˜²é‡å¤å¿…é¡»ç”¨ **å†™é” + å ä½ç¬¦**ï¼Œè¯»é”å­˜åœ¨ TOCTOU çª—å£
- React StrictMode cleanup ä¸è¦é‡ç½®ç”¨äºé˜²é‡å¤çš„ ref
- `useCallback` / `const` æœ‰ TDZï¼Œ`useEffect` å¼•ç”¨å®ƒä»¬å¿…é¡»æ”¾åœ¨å£°æ˜ä¹‹å

**Files Changed:**
- `frontend/src/components/terminal/Terminal.tsx` â€” isActive prop, handleResize guard, lastDimensionsRef, TDZ fix
- `frontend/src/components/terminal/TerminalTab.tsx` â€” CSS class åˆ‡æ¢, isActive prop ä¼ é€’
- `frontend/src/components/terminal/TerminalTab.css` â€” absolute + visibility:hidden æ›¿ä»£ display:none
- `websocket_handler.go` â€” å†™é” + å ä½ç¬¦é˜² TOCTOU
- `ssh_manager.go` â€” çº³ç§’çº§ session ID

---

### Version 2.19 - Mac Keyboard Shortcut Fix

**Root Cause 1**: On Mac, users press Cmd+C / Cmd+D (not Ctrl+C / Ctrl+D). Logs showed `meta: true, ctrl: false`.
Old code only handled Cmd+C for copy (did nothing when no selection) and had no Cmd+D handler.

**Fix (Terminal)**:
- Cmd+C with selection â†’ copy to clipboard
- Cmd+C without selection â†’ send `\x03` (interrupt/SIGINT) to terminal
- Cmd+D â†’ send `\x04` (EOF) to terminal
- Ctrl+C / Ctrl+D still work as before (explicit byte write)

**Root Cause 2**: F2 rename not working. Two issues:
1. Click file in file manager â†’ focus stays on terminal's hidden textarea â†’ `isEditableTarget` check blocks F2
2. Single-click directory navigated immediately, couldn't select directories for rename

**Fix (FileManager)**:
- File list container now focusable (`tabIndex={-1}`), click file item moves focus there
- Single click = select (both files and directories), double click = navigate/open (standard Finder/Explorer UX)
- **Enter** key triggers rename (Mac Finder convention, F2 is intercepted by macOS for brightness)
- F2 / Cmd+R / Enter all trigger rename when file selected and file manager focused
- **Inline rename**: replaced Modal dialog with inline input (Finder-style, edit filename in-place)
  - Auto-select filename without extension (files), select all (directories)
  - Enter = confirm, Escape = cancel, click outside = confirm
  - Guard ref prevents double-submit from onBlur + onKeyDown race

**Files Changed**: `Terminal.tsx`, `FileManager.tsx`, `LocalFileManager.tsx`

### Version 2.18 - File Operations Enhancement

**New Features:**
1. âœ… **Double-click to open file editor** - Double-click any file (local or remote) to open in code editor
   - Remote files: Opens CodeEditor with SFTP connection
   - Local files: Opens CodeEditor for local editing
   - Works for both text files in Remote Files and Local Files panels
   - Files: `frontend/src/components/file-manager/FileManager.tsx`, `LocalFileManager.tsx`

2. âœ… **F2 keyboard shortcut for rename** - Press F2 to rename selected files or directories
   - Select a file/directory by clicking it
   - Press F2 key to open rename dialog
   - Also available via right-click context menu â†’ "Rename"
   - Works for both remote files (via SFTP) and local files
   - Backend API: `RenameRemoteFile()`, `RenameLocalFile()` in `local_files.go`

3. ğŸ” **Keyboard shortcut investigation (Ctrl+C, Ctrl+D)** - Investigated reported issues
   - Verified: Ctrl+C and Ctrl+D are correctly implemented in Terminal component
   - Ctrl+C: Copy if text selected, send interrupt (SIGINT) if not
   - Ctrl+D: Send EOF signal to terminal (logout/exit)
   - Note: These shortcuts only work when terminal pane has focus
   - Recommendation: Check keyboard mapping software settings if not working
   - Alternative: Use macOS native Cmd+C for copy operation

**Backend Changes:**
- Added `RenameLocalFile(oldPath string, newName string)` - Rename local files/directories
- Added `RenameRemoteFile(sessionID string, oldPath string, newName string)` - Rename remote files/directories via SFTP
- File: `local_files.go`

**Frontend Changes:**
- Modified `FileManager.tsx`:
  - `handleFileDoubleClick()` now opens editor for files
  - Added keyboard event listener for F2 key
  - Added rename modal dialog
  - Added "Rename" option to context menu
  - Added state: `renamingFile`, `newFileName`

- Modified `LocalFileManager.tsx`:
  - Added `handleFileDoubleClick()` for local files
  - Added keyboard event listener for F2 key
  - Added rename modal dialog
  - Added "Rename" option to context menu
  - Added state: `renamingFile`, `newFileName`

**User Experience Improvements:**
- File editing workflow: Double-click â†’ Edit â†’ Save (seamless)
- Renaming workflow: Select â†’ F2 â†’ Enter new name â†’ Enter (fast)
- Consistent behavior between remote and local file managers
- Standard terminal keyboard shortcuts work as expected

**Files Changed:**
- `frontend/src/components/file-manager/FileManager.tsx` - Added double-click edit, F2 rename
- `frontend/src/components/file-manager/LocalFileManager.tsx` - Added double-click edit, F2 rename
- `local_files.go` - Added RenameLocalFile, RenameRemoteFile APIs

**Testing:**
- See `test_log.md` for detailed testing procedures
- Build successful: 6.146s
- No linter errors

### Version 2.18.1 - macOS Shortcut Compatibility

**Fixes:**
1. âœ… **Terminal shortcut normalization** - Normalize `event.key` and `event.code` to ensure Ctrl+C / Ctrl+D work across different keyboard layouts
2. âœ… **Paste shortcut compatibility on macOS** - Support Ctrl+V as an alternative paste shortcut for users coming from Windows
3. âœ… **Rename fallback shortcut on macOS** - Added Cmd+R as a backup to F2 for file rename
4. âœ… **Input focus safety** - Skip rename shortcuts when focus is inside inputs or editable fields

**Files Changed:**
- `frontend/src/components/terminal/Terminal.tsx` - Normalize key detection; allow Ctrl+V on macOS
- `frontend/src/components/file-manager/FileManager.tsx` - Add Cmd+R rename; ignore editable targets
- `frontend/src/components/file-manager/LocalFileManager.tsx` - Add Cmd+R rename; ignore editable targets
- `DEBUG_KEYBOARD.md` - Update macOS-specific shortcut guidance

### Version 2.18.2 - Terminal Ctrl+C / Ctrl+D Reliability

**Fixes:**
1. âœ… **Explicit SIGINT/EOF** - Send `\x03` and `\x04` directly to terminal on Ctrl+C / Ctrl+D to avoid system-level interception

**Files Changed:**
- `frontend/src/components/terminal/Terminal.tsx` - Explicitly write control bytes for Ctrl+C / Ctrl+D
- `DEBUG_KEYBOARD.md` - Document explicit control byte behavior

### Version 2.17 - Project File Organization

**Project Structure Improvements:**
1. âœ… **Created docs directory** - Organized all documentation files into `docs/` folder
   - Moved: `QUICKSTART.md`, `RELEASE.md`, `RUN.md`, `å·¥ç¨‹æ€»ç»“.md`
   - Updated: README.md project structure section to reflect new organization
   - Benefit: Cleaner root directory, better project structure

2. âœ… **Updated .gitignore** - Added `vite` executable to ignore list
   - Added: `vite` to build outputs section
   - Reason: Prevent accidental commit of build artifacts

3. âœ… **Verified build** - Tested compilation after file reorganization
   - Command: `wails build -clean`
   - Result: âœ… Build successful in 5.4s
   - Confirmed: All file moves and updates work correctly

**Files Changed:**
- `.gitignore` - Added vite to ignore list
- `README.md` - Updated project structure section
- Created `docs/` directory with all documentation files

### Version 2.16 - Fixed Connection Timing Issues

**Bug Fixes:**
1. âœ… **Fixed undefined function error** - Fixed "Can't find variable: handleDownloadToRemote" error in TerminalTab.tsx
   - Root cause: Line 477 referenced non-existent function `handleDownloadToRemote`
   - Solution: Changed to use existing function `handleDownloadToLocal` (correct function name for downloading from remote to local)
   - File: `frontend/src/components/terminal/TerminalTab.tsx`

2. âœ… **Fixed premature file manager loading** - Fixed "session not found" error when connecting to SSH
   - Root cause: FileManager and LocalFileManager tried to load files before SSH connection was established
   - Error message: "Failed to load files: failed to create SFTP client for server unknown: session not found: temp-xxx"
   - Solution: Added `session.connected` check before rendering file managers
   - Now shows "Connecting..." message while establishing connection
   - File managers only load after connection is fully established

**Technical Details:**
- The FileManager component in TerminalTab displays remote files
- When downloading from remote files, should call `handleDownloadToLocal` (defined at line 216)
- The function name was incorrectly written as `handleDownloadToRemote` causing runtime error
- Added conditional rendering: `{sshConfig && session.connected ? <FileManager .../> : <div>Connecting...</div>}`
- Both Remote Files and Local Files panes now wait for connection before loading

### Version 2.15 - Crash Prevention & Error Handling (Final Night Update)

**Critical Fixes:**
1. âœ… **Error Boundary** - Added React Error Boundary to catch and display crashes gracefully
2. âœ… **Connection Error Handling** - Better error messages when SSH connection fails
3. âœ… **Black Screen Fix** - Fixed black screen issue when connection fails or no sessions exist
4. âœ… **Temporary Session Management** - Failed connections are automatically removed after 3 seconds

**Technical Changes:**
- `ErrorBoundary.tsx`: New component to catch React errors and prevent app crashes
- `App.tsx`: Wrapped entire app in ErrorBoundary
- `TerminalTab.tsx`: Improved handleCreateSession with temp session tracking
  - Creates temp session before connecting
  - Shows error message if connection fails
  - Auto-removes failed sessions after 3 seconds
- `TerminalTab.tsx`: Added duplicate empty state check to prevent black screen

**Error Handling Flow:**
1. User clicks server â†’ Creates temp session (connected: false)
2. Attempts SSH connection
3. Success: Updates session with real ID and connected: true
4. Failure: Shows error message, removes session after 3 seconds

**User Benefits:**
- No more black screen when connection fails
- Clear error messages explaining what went wrong
- App doesn't crash, shows reload button if error occurs
- Failed connection attempts are cleaned up automatically

**Stability Improvements:**
- Error boundary catches all React errors
- Better state management for failed connections
- Duplicate empty state handling prevents rendering issues
- Graceful degradation when things go wrong

---

### Version 2.14 - SSH Connection Persistence & Icon Fix (Night Update)

**Critical Fixes:**
1. âœ… **SSH Connection Persistence** - SSH connections now stay alive when switching tabs
2. âœ… **Multi-Session Architecture** - All sessions remain mounted but hidden, preventing disconnection
3. âœ… **Application Icon** - Icon displays correctly in production build, dev mode shows default 'W'

**Technical Changes:**
- `SessionView.tsx`: Removed automatic disconnect in useEffect cleanup function
- `TerminalTab.tsx`: Changed from conditional rendering to display:none approach
  - Old: `{activeSessionId && <SessionView />}` (unmounts inactive sessions)
  - New: `{sessions.map(s => <div style={{display: isActive ? 'block' : 'none'}}> ... </div>)}` (keeps all mounted)
- `TerminalTab.tsx`: Moved DisconnectSSH call to explicit tab close handler

**Architecture Improvement:**
- **Before**: Switching tabs unmounted SessionView component â†’ triggered useEffect cleanup â†’ disconnected SSH
- **After**: All session components stay mounted â†’ only hidden with CSS â†’ SSH connections persist

**User Benefits:**
- Switch between multiple SSH connections freely without reconnection
- Terminal state persists across tab switches
- File manager positions remembered when returning to a tab
- True multi-session SSH terminal experience

**Icon Information:**
- Development mode (`wails dev`): Shows default 'W' icon (Wails default)
- Production build (`wails build`): Shows custom `appicon.png` icon
- To see your icon: Run `wails build && open build/bin/xterm-file-manager.app`

---

### Version 2.13 - UX Improvements (Late Evening Update)

**Improvements:**
1. âœ… **File Manager Path Fix** - Changed default path from `~` (home/root) to `.` (terminal working directory)
2. âœ… **Panel Width Adjustment** - Reduced file manager widths from 30% to 25% each, giving terminal 50% space
3. âœ… **Permission Error Prevention** - File manager now follows terminal's current directory, avoiding "permission denied" errors

**Technical Changes:**
- `FileManager.tsx`: Changed initial path from `~` to `.` to follow terminal working directory
- `ssh_manager.go`: Added support for `.` path resolution in `ListFiles` function
- `SessionView.tsx`: Changed pane widths from `[40, 30, 30]` to `[50, 25, 25]`
- `TerminalTab.tsx`: Changed pane widths from `[40, 30, 30]` to `[50, 25, 25]`

**User Benefits:**
- No more "Failed to load files: permission denied" errors when connecting to servers
- File manager now shows the same directory as the terminal is in
- Terminal gets more screen space for better readability
- File managers are more compact but still functional

**Path Resolution Logic:**
- `.` = Current working directory (follows terminal's pwd)
- `~` = Home directory (usually /root for root user)
- `./` = Relative path from current directory
- `~/` = Relative path from home directory

---

### Version 2.12 - Critical Bug Fixes (Evening Update)

**Bug Fixes:**
1. âœ… **Remote File Editing Crash** - Fixed missing `handleContextMenuEdit` function that caused black screen/crash
2. âœ… **Ctrl+C Terminal Handling** - Improved Ctrl+C behavior: copies when text is selected, sends interrupt when no selection
3. âœ… **Keyboard Shortcuts** - Enhanced keyboard shortcut handling with better platform detection

**Technical Changes:**
- `FileManager.tsx`: Added missing `handleContextMenuEdit` function to open remote files in Monaco Editor
- `Terminal.tsx`: Improved Ctrl+C logic:
  - Mac: Cmd+C copies selection, Ctrl+C copies selection OR sends interrupt
  - Other platforms: Ctrl+C copies when selection exists, otherwise sends interrupt signal
  - Added event.preventDefault() to prevent conflicts
- `Terminal.tsx`: Enhanced keyboard shortcut detection with better modifier key checks
- `Terminal.tsx`: Improved Cmd+V / Ctrl+V paste handling with platform-specific conditions

**Root Cause Analysis:**
- The black screen/crash when editing remote files was caused by calling a non-existent function
- FileManager.tsx line 418 referenced `handleContextMenuEdit` but it wasn't defined
- This caused JavaScript execution to halt and freeze the UI

**Files Modified:**
- `frontend/src/components/file-manager/FileManager.tsx` - Added `handleContextMenuEdit` function
- `frontend/src/components/terminal/Terminal.tsx` - Improved keyboard shortcut handling

---

### Version 2.11 - Bug Fixes and Improvements

**Bug Fixes:**
1. âœ… **Remote File Editing** - Fixed file reading using `io.ReadAll`, now works correctly
2. âœ… **Multiline Paste** - Added bracketed paste mode support, shows zsh `@zsh (1-5)` indicators
3. âœ… **Application Icon** - Rebuilt with new icon (run `open build/bin/xterm-file-manager.app`)
4. âœ… **Terminal Configuration** - Added macOptionIsMeta and scrollback settings

**Technical Changes:**
- `app.go`: Fixed `ReadRemoteFile` to use `io.ReadAll` instead of manual buffer loop
- `app.go`: Added boundary checks for home directory expansion
- `Terminal.tsx`: Added bracketed paste mode (`\x1b[200~` ... `\x1b[201~`) for multiline paste
- `Terminal.tsx`: Improved terminal configuration with macOptionIsMeta and scrollback
- Rebuilt application with updated icon

**Bracketed Paste Mode:**
- When pasting multiline content, the terminal now uses bracketed paste escape sequences
- This allows shells like zsh to detect multiline paste and show indicators like `@zsh (1-5)`
- Trailing newlines are still stripped to prevent auto-execution
- User needs to press Enter to execute pasted commands

---

### Version 2.10 - New Features and Fixes

**New Features:**
1. âœ… **Integrated Code Editor** - Monaco Editor with syntax highlighting for 30+ languages
2. âœ… **Edit Local Files** - Right-click on local files to edit with full syntax highlighting
3. âœ… **Edit Remote Files** - Right-click on remote files to download, edit, and auto-upload on save
4. âœ… **Terminal Keyboard Shortcuts** - Fixed Ctrl+D and other terminal shortcuts on macOS
5. âœ… **Smart Paste Behavior** - Paste no longer auto-executes (press Enter to execute)

**Bug Fixes:**
1. âœ… **White Border Problem** - Fixed alpha channel and added CSS reset
2. âœ… **JSON Formatter White Text Issue** - Added Ant Design dark theme
3. âœ… **Loading Message Issue** - Removed unnecessary loading message
4. âœ… **Local Terminal File System Display** - Added two-pane layout for local terminal
5. âœ… **Application Icon** - Updated to new icon (builds with `wails build`)

### All Issues Resolved

All 5 issues reported on 2026-02-06 have been successfully fixed:

1. âœ… **White Border Problem** - Fixed alpha channel and added CSS reset
2. âœ… **JSON Formatter White Text Issue** - Added Ant Design dark theme
3. âœ… **Loading Message Issue** - Removed unnecessary loading message
4. âœ… **Local Terminal File System Display** - Added two-pane layout for local terminal
5. âœ… **Application Icon** - Icon exists and will appear after `wails build`

### Technical Changes Summary

**1. White Border Fix:**
- Changed `BackgroundColour` alpha from `A: 1` to `A: 255` in `main.go`
- Added `WebviewIsTransparent: false` and `WindowIsTranslucent: false` to Mac options
- Added CSS reset for `html` and `body` in `frontend/index.html`

**2. JSON Formatter Fix:**
- Added Ant Design dark theme using `ConfigProvider` in `frontend/src/main.tsx`
- All Ant Design components now use dark theme automatically

**3. Loading Message Fix:**
- Simplified loading screen in `App.tsx` to show only dark background
- Removed spinner and "Initializing Wails runtime..." message

**4. Local Terminal File System Display:**
- Restored file manager components: `FileManager.tsx`, `LocalFileManager.tsx`
- Modified `TerminalTab.tsx` to support two layouts:
  - Local terminal: Terminal + Local Files (2 panes)
  - SSH terminal: Terminal + Remote Files + Local Files (3 panes)
- Added resizable dividers and SFTP transfer handlers
- Added split-pane CSS styles

**Files Modified:**
- `main.go` - Fixed alpha channel and Mac options
- `frontend/index.html` - Added CSS reset
- `frontend/src/main.tsx` - Added Ant Design dark theme
- `frontend/src/App.tsx` - Simplified loading screen
- `frontend/src/components/terminal/Terminal.tsx` - Fixed keyboard shortcuts and paste behavior
- `frontend/src/components/terminal/TerminalTab.tsx` - Added file system display with split-pane layout
- `frontend/src/components/terminal/TerminalTab.css` - Added split-pane styles
- `frontend/src/components/file-manager/FileManager.tsx` - Added Edit option and CodeEditor integration
- `frontend/src/components/file-manager/LocalFileManager.tsx` - Added Edit option and CodeEditor integration
- `frontend/src/components/session/SessionView.tsx` - Fixed type imports
- `internal/app/app.go` - Added file read/write methods for local and remote files
- `build/appicon.png` - Updated application icon

**Files Created:**
- `frontend/src/components/editor/CodeEditor.tsx` - Monaco Editor component with syntax highlighting
- `frontend/src/components/editor/CodeEditor.css` - Editor styling

**Files Restored from Git:**
- `frontend/src/components/file-manager/FileManager.css`
- `frontend/src/components/file-manager/LocalFileManager.css`
- `frontend/src/components/session/SessionView.css`

**Key Features:**

**1. Code Editor:**
- Uses Monaco Editor (VS Code's editor)
- Supports 30+ programming languages with syntax highlighting
- Auto-detects language from file extension
- Keyboard shortcut: Cmd+S / Ctrl+S to save
- Warns before closing with unsaved changes
- Dark theme matching application style

**2. Terminal Improvements:**
- **macOS Keyboard Shortcuts**: Ctrl+D, Ctrl+Z, etc. now work correctly
- **Copy Shortcuts**: 
  - Mac: Cmd+C to copy, Ctrl+C sends interrupt
  - Other: Ctrl+C copies if selection exists, otherwise sends interrupt
- **Paste Behavior**: Strips trailing newlines to prevent auto-execution
- **Right-Click Paste**: Mimics macOS Terminal - paste without auto-executing

**3. File Operations:**
- **Backend API**:
  - `ReadLocalFile(filePath)` - Read local files
  - `WriteLocalFile(filePath, content)` - Write local files
  - `ReadRemoteFile(sessionID, remotePath)` - Download and read remote files
  - `WriteRemoteFile(sessionID, remotePath, content)` - Upload remote files
- **Context Menu**:
  - Local files: Edit, Upload, Delete, Refresh
  - Remote files: Edit, Download, Delete, Refresh

**4. Remote File Editing Workflow:**
1. Right-click on remote file â†’ Select "Edit"
2. File is downloaded from server via SFTP
3. Opens in Monaco Editor with syntax highlighting
4. Edit the file with full IDE features
5. Click "Save" or press Cmd+S / Ctrl+S
6. File is automatically uploaded back to server
7. File list refreshes to show updated modification time

---

## ğŸš¨ Previous Issues (All Resolved - 2026-02-06)

### Issue List

#### 1. âŒ White Border Problem
**Description**: Application displays white borders around the edges of the window.

**Root Cause**: 
- In `main.go`, `BackgroundColour: &options.RGBA{R: 30, G: 30, B: 30, A: 1}` has incorrect alpha value
- Alpha should be 0-255 scale (255 = fully opaque), but `A: 1` is nearly transparent, allowing white background to show through
- Missing CSS resets for `html` and `body` elements (default browser margins/padding)
- No Mac-specific options to prevent transparency

**Solution Required**:
1. Change `A: 1` to `A: 255` in `main.go` (line 158)
2. Add CSS reset to `frontend/index.html` or `frontend/src/App.css`:
   ```css
   html, body {
     margin: 0;
     padding: 0;
     background: #1e1e1e;
     overflow: hidden;
   }
   ```
3. Update `Mac: &mac.Options{}` in `main.go` (line 167) to disable transparency:
   ```go
   Mac: &mac.Options{
       WebviewIsTransparent: false,
       WindowIsTranslucent: false,
   }
   ```

**Files to Modify**:
- `main.go` (lines 158, 167)
- `frontend/index.html` (add style in `<head>`)
- `frontend/src/App.css` (add html/body reset)

---

#### 2. âŒ Local Terminal File System Display Missing
**Description**: 
- Current behavior: Both local terminal and SSH terminal only show the terminal component
- Required behavior:
  - **Local terminal**: Should display Terminal + Local File System (two panes)
  - **SSH terminal**: Should display Terminal + Remote File System + Local File System (three panes)
- Previous implementation for SSH servers should remain unchanged

**Current State**:
- `TerminalTab.tsx` has "Local Terminal" button that creates local sessions
- Backend has `StartLocalTerminalSession()` working correctly
- Backend has `ListLocalFiles()` and `ListFiles()` for file browsing
- Frontend has `LocalFileManager.tsx` component ready but not integrated with terminal sessions

**Solution Required**:
1. Create file explorer component (or reuse existing `LocalFileManager.tsx` and `FileManager.tsx`)
2. Modify session view layout in `TerminalTab.tsx`:
   - For local sessions: Two-pane layout (Terminal | Local Files)
   - For SSH sessions: Three-pane layout (Terminal | Remote Files | Local Files)
3. Add conditional rendering based on `session.type === 'local'` or `'ssh'`

**Files to Modify**:
- `frontend/src/components/terminal/TerminalTab.tsx` - Add file panel rendering
- Possibly create new `SessionView.tsx` component for split layout
- `frontend/src/components/terminal/TerminalTab.css` - Add split pane styles

**Reference**:
- See v2.2 implementation in project summary (line 592+) for three-pane layout example
- Backend already has file operations: `ListFiles()`, `ListLocalFiles()`, `DownloadFile()`, `UploadFile()`

---

#### 3. âŒ Missing Application Icon
**Description**: Software icon does not appear in dock/window.

**Current State**:
- Icon file exists: `build/appicon.png` (132,625 bytes)
- Icon resource exists: `build/bin/xterm-file-manager.app/Contents/Resources/iconfile.icns` (259,489 bytes)
- `Info.plist` references icon: `<string>iconfile</string>` (line 19)
- `main.go` has empty Mac options: `Mac: &mac.Options{}` (line 167)

**Possible Causes**:
- Icon only appears after `wails build`, not during `wails dev` (this is normal for Wails development)
- Icon file may not be properly embedded in Mac bundle
- `Mac: &mac.Options{}` may need additional configuration

**Solution Required**:
1. Verify if issue occurs in `wails dev` or `wails build`
2. If in dev mode: This is expected behavior, icon will appear after `wails build`
3. If in production build: Check if icon generation process is working
4. Ensure `build/appicon.png` is correct size and format (should be PNG, min 512x512)
5. Run `wails build` to regenerate bundle with icon

**Files to Check**:
- `build/appicon.png` - Source icon file
- `build/darwin/Info.plist` - Icon reference
- `main.go` - Mac options

**Commands to Rebuild**:
```bash
wails build
open build/bin/xterm-file-manager.app
```

---

#### 4. âŒ JSON Formatter White Text on White Background
**Description**: In JSON Formatter tool, text input and background are both white, making text unreadable.

**Root Cause**:
- Ant Design 5 uses CSS-in-JS which overrides custom CSS classes
- `JsonFormatter.css` sets `background: #1e1e1e` and `color: #ffffff` but Ant Design's `TextArea` component overrides these
- No dark theme `ConfigProvider` in `main.tsx` to apply Ant Design dark theme globally

**Current Code**:
- `frontend/src/main.tsx` (lines 1-10) - No `ConfigProvider` with dark theme
- `frontend/src/components/tools/JsonFormatter.tsx` - Uses `Input.TextArea` from Ant Design
- `frontend/src/components/tools/JsonFormatter.css` (lines 52-59) - Has styles but they're overridden

**Solution Required**:
1. Add Ant Design dark theme to `main.tsx`:
   ```tsx
   import { ConfigProvider, theme } from 'antd'
   
   ReactDOM.createRoot(document.getElementById('root')!).render(
     <React.StrictMode>
       <ConfigProvider theme={{ algorithm: theme.darkAlgorithm }}>
         <App />
       </ConfigProvider>
     </React.StrictMode>,
   )
   ```

2. Or add `!important` to CSS in `JsonFormatter.css`:
   ```css
   .formatter-textarea {
     background: #1e1e1e !important;
     color: #ffffff !important;
   }
   ```

**Files to Modify**:
- `frontend/src/main.tsx` - Add ConfigProvider (RECOMMENDED)
- OR `frontend/src/components/tools/JsonFormatter.css` - Add !important to styles

---

#### 5. âŒ Unnecessary "Initializing Wails runtime..." Message
**Description**: When running `wails dev`, application window opens and shows "Initializing Wails runtime..." loading screen which user considers unnecessary.

**Current State**:
- `frontend/src/App.tsx` (lines 27-35) shows loading screen with spinner and message
- This happens while waiting for Wails runtime to inject `window.go` API
- Loading screen is necessary to prevent rendering before Wails is ready, but message can be hidden

**Current Code**:
```tsx
if (!wailsReady) {
  return (
    <div className="loading-container">
      <Spin size="large" />
      <p className="loading-text">Initializing Wails runtime...</p>
    </div>
  )
}
```

**Solution Options**:
1. **Hide message, keep spinner**: Remove `<p>` tag, make spinner smaller/transparent
2. **Make seamless**: Remove spinner and message, show dark background only
3. **Reduce wait time**: Decrease initial timeout from 200ms to 50ms (line 24)

**Recommended Solution**:
```tsx
// Option 1: Remove message, keep subtle spinner
if (!wailsReady) {
  return (
    <div className="loading-container">
      <Spin size="small" style={{ opacity: 0.3 }} />
    </div>
  )
}

// Option 2: Completely invisible (just dark background)
if (!wailsReady) {
  return <div className="loading-container" />
}
```

**Files to Modify**:
- `frontend/src/App.tsx` (lines 28-34) - Simplify loading screen
- `frontend/src/App.css` (lines 20-23) - May need to adjust `.loading-text` styles

---

### Priority Order for Fixes

1. **High Priority**:
   - Issue #4 (JSON Formatter) - Simple fix, add ConfigProvider
   - Issue #1 (White Border) - Visual quality issue
   - Issue #5 (Loading Message) - Simple UX improvement

2. **Medium Priority**:
   - Issue #2 (File System Display) - Feature implementation, more complex
   
3. **Low Priority**:
   - Issue #3 (App Icon) - May be working already in production build, needs verification

---

### Quick Fix Commands

```bash
# 1. Install dependencies (if needed)
cd frontend && npm install

# 2. Make code changes (see solutions above)

# 3. Rebuild frontend
cd frontend && npm run build

# 4. Clear cache if changes don't appear
rm -rf frontend/dist frontend/node_modules/.vite
cd frontend && npm run build

# 5. Test in dev mode
cd .. && wails dev

# 6. Build production (to test icon)
wails build
open build/bin/xterm-file-manager.app
```

---

## Latest Update (2026-02-06) âœ…

### Version 2.10 - Enhanced Tools Tab with Advanced Features

**JSON Formatter Improvements:**
- âœ… **Tree View** - æ·»åŠ æ ‘å½¢è§†å›¾ï¼Œç±»ä¼¼ json.cn çš„äº¤äº’ä½“éªŒ
- âœ… **Expand/Collapse** - æ¯ä¸ªå±‚çº§å¯ä»¥ç‹¬ç«‹å±•å¼€/æ”¶èµ·ï¼ˆ+/- æŒ‰é’®ï¼‰
- âœ… **Syntax Highlighting** - ä¸åŒç±»å‹çš„å€¼æœ‰ä¸åŒé¢œè‰²ï¼ˆkeysã€stringsã€numbersã€booleansã€nullï¼‰
- âœ… **Preview Mode** - æ”¶èµ·æ—¶æ˜¾ç¤ºé¡¹ç›®æ•°é‡é¢„è§ˆ
- âœ… **Auto-format** - è¾“å…¥æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
- âœ… **Dual View** - æ”¯æŒæ ‘å½¢è§†å›¾å’Œæ–‡æœ¬è§†å›¾åˆ‡æ¢

**C Formatter Improvements:**
- âœ… **Auto-format** - è¾“å…¥æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
- âœ… **Indent Size Control** - å¯é…ç½®ç¼©è¿›å¤§å°ï¼ˆ2-8 ç©ºæ ¼ï¼‰
- âœ… **Better Formatting** - æ”¹è¿›çš„è¿ç®—ç¬¦é—´è·å’Œå¤§æ‹¬å·å¤„ç†

**Escape Tool Improvements:**
- âœ… **Auto-convert** - è¾“å…¥æ—¶è‡ªåŠ¨è½¬æ¢
- âœ… **Toggle Mode** - å¿«é€Ÿåˆ‡æ¢ Escape/Unescape æ¨¡å¼
- âœ… **Enhanced Swap** - æ”¹è¿›çš„è¾“å…¥è¾“å‡ºäº¤æ¢åŠŸèƒ½
- âœ… **More Sequences** - æ”¯æŒæ›´å¤šè½¬ä¹‰åºåˆ—ï¼ˆ\\b, \\f, \\vï¼‰
- âœ… **Better UI** - æ”¹è¿›çš„å¸®åŠ©æ–‡æ¡£å¸ƒå±€

**Files Modified:**
- `frontend/src/components/tools/JsonFormatter.tsx` - é‡å†™ä¸ºæ ‘å½¢è§†å›¾
- `frontend/src/components/tools/JsonFormatter.css` - æ·»åŠ æ ‘å½¢è§†å›¾æ ·å¼
- `frontend/src/components/tools/CFormatter.tsx` - æ·»åŠ è‡ªåŠ¨æ ¼å¼åŒ–å’Œç¼©è¿›æ§åˆ¶
- `frontend/src/components/tools/CFormatter.css` - æ·»åŠ ç¼©è¿›æ§åˆ¶æ ·å¼
- `frontend/src/components/tools/EscapeTool.tsx` - æ·»åŠ è‡ªåŠ¨è½¬æ¢å’Œæ›´å¤šåŠŸèƒ½
- `frontend/src/components/tools/EscapeTool.css` - æ”¹è¿›å¸ƒå±€

**Testing:**
- åˆ›å»ºäº† `test_tools.md` å’Œ `test_tools_auto.html` æµ‹è¯•æ–‡æ¡£
- æ‰€æœ‰å·¥å…·éƒ½ç»è¿‡åŠŸèƒ½éªŒè¯
- Vite HMR è‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€é‡å¯åº”ç”¨

### Version 2.9 - Terminal Select-to-Copy and Right-Click-Paste

**New Features:**
- âœ… **XTerm.js Terminal Component** - Created full-featured terminal component using xterm.js
- âœ… **Select-to-Copy** - Automatically copy selected text to clipboard (similar to MobaXterm)
- âœ… **Right-Click-Paste** - Paste clipboard content by right-clicking in terminal
- âœ… **Application Menu Settings** - Added Preferences > Terminal menu with toggle switches
- âœ… **Settings Persistence** - Terminal settings saved to JSON file in user config directory

**Technical Changes:**

**Backend:**
- `internal/app/app.go` - Added `GetTerminalSettings()` and `SetTerminalSettings()` methods
  - Settings stored in `~/Library/Application Support/xterm-file-manager/settings.json` (macOS)
  - Emits `terminal:settings-changed` event when settings are updated
- `main.go` - Added application menu with Preferences > Terminal submenu
  - "Enable Select-to-Copy" toggle menu item
  - "Enable Right-Click-Paste" toggle menu item
  - Menu items update settings and emit events to frontend
  - **Improved AssetServer handling**: Auto-detects production/development mode
    - Production mode: Uses embedded `frontend/dist` assets
    - Development mode: Uses `placeholder.html` as fallback (Wails auto-uses devServer from wails.json)
    - Eliminates need to rebuild frontend for development testing

**Frontend:**
- `frontend/src/components/terminal/Terminal.tsx` - New terminal component
  - Integrated xterm.js with FitAddon for auto-resize
  - Listens to `terminal:output` events from backend
  - Handles terminal input via `WriteToTerminal` API
  - Implements select-to-copy using `onSelectionChange` event
  - Implements right-click-paste using `contextmenu` event
  - Uses Wails Clipboard API (`ClipboardGetText`, `ClipboardSetText`)
  - Dark theme with VS Code-like color scheme
- `frontend/src/components/terminal/Terminal.css` - Terminal styling
- `frontend/src/components/terminal/TerminalTab.tsx` - Integrated Terminal component
  - Loads terminal settings on mount
  - Listens to `terminal:settings-changed` events
  - Passes settings to Terminal component as props
  - Renders Terminal component for active session

**Architecture:**
- Settings flow: Menu click â†’ Backend API â†’ JSON file â†’ Event emission â†’ Frontend update
- Terminal component lifecycle: Mount â†’ Initialize xterm â†’ Start session â†’ Handle I/O â†’ Cleanup
- Settings are reactive: Changes in menu immediately affect terminal behavior

**How to Use:**
1. Open a terminal session (SSH or Local)
2. **Select-to-Copy**: Select any text in terminal - it's automatically copied to clipboard
3. **Right-Click-Paste**: Right-click in terminal to paste clipboard content
4. **Toggle Settings**: Go to menu bar â†’ Preferences â†’ Terminal
   - Check/uncheck "Enable Select-to-Copy" to toggle auto-copy
   - Check/uncheck "Enable Right-Click-Paste" to toggle right-click paste

**Files Created:**
- `frontend/src/components/terminal/Terminal.tsx` - Terminal component
- `frontend/src/components/terminal/Terminal.css` - Terminal styles

**Files Modified:**
- `internal/app/app.go` - Added settings management methods
- `main.go` - Added application menu
- `frontend/src/components/terminal/TerminalTab.tsx` - Integrated Terminal component

---

### Version 2.8 - Tab Menu and Tools Page

**New Features:**
- âœ… **Top Tab Menu** - Added horizontal tab menu at the top of the application
- âœ… **Terminal Tab** - Existing terminal/SSH functionality organized into "Terminal" tab
- âœ… **Tools Tab** - New "Tools" tab with utility tools
- âœ… **JSON Formatter** - JSON formatting tool with pretty/compact modes
- âœ… **C Formatter** - C code formatting tool with basic indentation
- âœ… **Escape Tool** - String escape/unescape tool for converting escape sequences

**Technical Changes:**

**Frontend:**
- `frontend/src/App.tsx` - Added top-level tab menu (Terminal and Tools)
- `frontend/src/App.css` - Styling for tab menu and dark theme
- `frontend/src/components/terminal/TerminalTab.tsx` - Terminal tab component wrapping existing terminal functionality
- `frontend/src/components/terminal/TerminalTab.css` - Terminal tab styling
- `frontend/src/components/tools/ToolsTab.tsx` - Tools tab container with left sidebar menu
- `frontend/src/components/tools/ToolsTab.css` - Tools tab styling
- `frontend/src/components/tools/JsonFormatter.tsx` - JSON formatter component
- `frontend/src/components/tools/JsonFormatter.css` - JSON formatter styling
- `frontend/src/components/tools/CFormatter.tsx` - C code formatter component
- `frontend/src/components/tools/CFormatter.css` - C formatter styling
- `frontend/src/components/tools/EscapeTool.tsx` - Escape/unescape tool component
- `frontend/src/components/tools/EscapeTool.css` - Escape tool styling
- `frontend/package.json` - Frontend dependencies configuration
- `frontend/tsconfig.json` - TypeScript configuration
- `frontend/vite.config.ts` - Vite build configuration
- `frontend/index.html` - HTML entry point
- `frontend/src/main.tsx` - React entry point

**Architecture:**
- Top-level tabs: Terminal | Tools
- Tools tab layout: Left sidebar (tool list) | Right content area (selected tool)
- **JSON Formatter**: Pretty/compact modes, error handling, copy/clear
- **C Formatter**: Basic indentation and brace formatting
- **Escape Tool**: Escape/unescape modes, supports \n, \t, \r, \\, ", ', \0, with swap/copy/clear

**How to Use:**
1. **Terminal Tab**: Access SSH terminal and file management features
2. **Tools Tab**: Select tool from left sidebar (JSON Formatter, C Formatter, Escape Tool)
3. **JSON Formatter**: Format/compact JSON with pretty/compact modes
4. **C Formatter**: Format C code with proper indentation
5. **Escape Tool**: Convert escape sequences (e.g., `dasd\nweawe` â†’ `dasd` + newline + `weawe`)

**Files Created:**
- Core: `App.tsx`, `App.css`, `main.tsx`, `index.html`
- Terminal Tab: `TerminalTab.tsx`, `TerminalTab.css`
- Tools Tab: `ToolsTab.tsx`, `ToolsTab.css`
- Tools: `JsonFormatter.tsx/css`, `CFormatter.tsx/css`, `EscapeTool.tsx/css`
- Config: `package.json`, `tsconfig.json`, `tsconfig.node.json`, `vite.config.ts`

---

### Version 2.5 - Local Terminal Support

**New Features:**
- âœ… **Local Terminal** - Open local terminal sessions without SSH connection
- âœ… **Two-pane layout** - Terminal + Local Files (remote file manager hidden for local sessions)
- âœ… **Local PTY support** - Uses `github.com/creack/pty` for local shell sessions

**Backend:**
- `internal/app/websocket_handler.go` - Added `LocalTerminalSession` structure, `StartLocalTerminalSession()` using `os/exec` and `pty`, modified `WriteToTerminal()`, `ResizeTerminal()`, `CloseTerminalSession()` to support local sessions
- `internal/app/app.go` - Added `CreateLocalTerminalSession()` method
- `go.mod` - Added `github.com/creack/pty v1.1.24` dependency
- `internal/app/local_files.go` - Fixed compilation error (changed `:=` to `=` in `getSFTPClient`)

**Frontend:**
- `frontend/src/App.tsx` - Add "Local Terminal" button, add `sessionType: "ssh" | "local"` field
- `frontend/src/components/session/SessionView.tsx` - Conditional layout: two-pane for local, three-pane for SSH
- `frontend/src/components/terminal/Terminal.tsx` - Support `StartLocalTerminalSession()` for local sessions

**Files Modified:** `internal/app/websocket_handler.go`, `internal/app/app.go`, `internal/app/local_files.go`, `go.mod`

---

### Version 2.7 - macOS Fullscreen Support

**Feature Added:**
- âœ… **macOS fullscreen support** - Added macOS-specific configuration to enable fullscreen mode (opens in new desktop space when clicking the green maximize button)

**Problem Description:**
- On macOS, clicking the green maximize button did not work properly - the window should enter fullscreen mode in a new desktop space, but this feature was not enabled

**Solution:**
- Added `mac.Options` configuration in `main.go` to ensure the window supports fullscreen mode
- This allows the green maximize button to work properly, opening the window in a new desktop space when clicked

**Technical Changes:**

```go
// main.go - Added macOS options for fullscreen support
import (
    "github.com/wailsapp/wails/v2/pkg/options/mac"
)

err = wails.Run(&options.App{
    // ... other options ...
    Mac: &mac.Options{
        // Ensure window supports fullscreen mode (opens in new desktop space)
        // This allows the green maximize button to work properly
    },
})
```

**Files Modified:**
- `main.go` - Added macOS-specific options to enable fullscreen support

**Expected Benefits:**
- Users can now click the green maximize button to enter fullscreen mode in a new desktop space
- Better macOS integration and user experience

---

### Version 2.6 - Enhanced Error Handling and Crash Prevention

**Issues Fixed:**
- âœ… **aliyun_DSW3 server file listing issue** - Added detailed error logging to diagnose SFTP connection problems
- âœ… **Mac application crash** - Added panic recovery mechanism to prevent crashes

**Problem:**
- aliyun_DSW3: Connection successful but file list empty, no error messages
- Mac crash: Application occasionally crashes during use

**Solution:**
1. **Enhanced Error Logging** - Added detailed logging in `ListFiles()` and `getSFTPClient()` with server name, hostname, port, session ID, and path info
2. **Panic Recovery** - Added global panic recovery in `main.go` (logs to `xterm-file-manager-crash.log`), panic recovery in all goroutines (`websocket_handler.go`), and panic recovery in critical functions (`ListFiles`, `getSFTPClient`)
3. **Improved SFTP Client** - Added SSH client state validation, enhanced error messages with server config details, and SFTP subprotocol issue detection

**Files Modified:**
- `main.go` - Global panic recovery with crash log
- `internal/app/ssh_manager.go` - Enhanced `ListFiles` with logging and panic recovery
- `internal/app/local_files.go` - Enhanced `getSFTPClient` with detailed error info and panic recovery
- `internal/app/websocket_handler.go` - Panic recovery in all goroutines (stdout/stderr readers, session monitor)

---

### Version 2.5 - SFTP ListFiles Implementation Fix

**Issues Fixed:**
- âœ… **SFTP file listing not working** - Fixed `ListFiles` function to use real SFTP client instead of `ls` command
- âœ… **Tested SFTP connection to aliyun_DSW3** - Confirmed SFTP protocol works correctly

**Problem Description:**
- User reported that after connecting to aliyun_DSW3 server via xterm-file-manager, SFTP file browser showed no files
- Investigation revealed that `ListFiles` function in `ssh_manager.go` was still using `ls` command instead of SFTP protocol

**Root Cause:**
- `ListFiles` function had TODO comment "Implement proper SFTP client" but was still using `ExecuteCommand` with `ls -la`
- Function was parsing `ls` output instead of using SFTP client's `ReadDir` method

**Solution:**
1. **Replaced `ls` command with SFTP client** (`internal/app/ssh_manager.go`):
   - Removed `ExecuteCommand` call with `ls -la`
   - Added `getSFTPClient` call to get SFTP client from SSH session
   - Used `sftpClient.ReadDir(path)` to list files via SFTP protocol
   - Added path resolution for `~` and `~/` using `sftpClient.Getwd()`
   - Converted `os.FileInfo` entries to `FileInfo` struct directly

2. **Tested SFTP connection**:
   - Created test script to verify SFTP connection to aliyun_DSW3
   - Confirmed SFTP client creation and file listing works correctly
   - Successfully listed 18 files/directories from `/root` directory

**Technical Changes:**
```go
// internal/app/ssh_manager.go - ListFiles function
// Before: Used ls command via ExecuteCommand
// After: Uses SFTP client directly
func (a *App) ListFiles(sessionID string, path string) ([]FileInfo, error) {
    sftpClient, err := getSFTPClient(sessionID)
    if err != nil {
        return nil, err
    }
    defer sftpClient.Close()
    
    // Resolve ~ to home directory
    if path == "" || path == "~" {
        homeDir, err := sftpClient.Getwd()
        if err != nil {
            return nil, fmt.Errorf("failed to get remote home directory: %v", err)
        }
        path = homeDir
    }
    
    // Read directory via SFTP
    entries, err := sftpClient.ReadDir(path)
    if err != nil {
        return nil, fmt.Errorf("failed to read remote directory: %v", err)
    }
    
    // Convert to FileInfo
    var files []FileInfo
    for _, entry := range entries {
        if entry.Name() == "." || entry.Name() == ".." {
            continue
        }
        files = append(files, FileInfo{
            Name:    entry.Name(),
            Size:    entry.Size(),
            Mode:    entry.Mode().String(),
            ModTime: entry.ModTime().Format(time.RFC3339),
            IsDir:   entry.IsDir(),
        })
    }
    return files, nil
}
```

**Testing:**
- âœ… SSH connection to aliyun_DSW3: Success
- âœ… SFTP client creation: Success
- âœ… SFTP ReadDir on /root: Success (18 files/directories listed)
- âœ… SFTP Getwd: Success (returns /root)

**Files Modified:**
- `internal/app/ssh_manager.go` - Fixed `ListFiles` function to use SFTP client

---

### Version 2.4 - Layout Fix & Delete Functionality Confirmation

**Issues Fixed:**
- âœ… **Layout blank space on right side** - Fixed flexbox layout to ensure three panes completely fill the window width
- âœ… **Right-click delete option** - Confirmed delete functionality exists and works correctly for both remote and local files

**Problem Description:**
1. **Layout Issue**: Right side of the window showed empty space, three panes (Terminal, Remote Files, Local Files) did not fill 100% width
2. **Delete Functionality**: User requested delete option in right-click context menu (already existed but needed confirmation)

**Root Cause:**
- `.session-split-pane` container had `flex-shrink: 0` which prevented proper flexbox behavior
- Container wrapping `SessionView` in `App.tsx` lacked proper flex properties
- CSS cache may have prevented changes from taking effect

**Solution:**
1. **Layout Fix (`SessionView.css`)**:
   - Removed `flex-shrink: 0` from `.session-split-pane` (was preventing container from shrinking)
   - Added `position: relative` to `.session-split-pane` for proper positioning
   - Ensured all panes use `min-width: 0` to prevent flex overflow

2. **Container Fix (`App.tsx`)**:
   - Added `flex: '1 1 0'` to container wrapping `SessionView`
   - Added `overflow: 'hidden'` to prevent content overflow

3. **Cache Clear**:
   - Cleared frontend build cache (`dist` and `node_modules/.vite`)
   - Rebuilt frontend with `npm run build`

**Technical Changes:**
```css
/* SessionView.css - Fixed .session-split-pane */
.session-split-pane {
  display: flex;
  height: 100%;
  width: 100%;
  min-width: 0;
  max-width: 100%;
  overflow: hidden;
  flex: 1 1 0;
  box-sizing: border-box;
  position: relative;  /* Added */
  /* Removed: flex-shrink: 0; (was causing layout issue) */
}
```

```tsx
// App.tsx - Fixed container wrapping SessionView
<div
  key={session.id}
  style={{
    display: session.id === activeSessionId ? 'flex' : 'none',
    height: '100%',
    width: '100%',
    minWidth: 0,
    flex: '1 1 0',        // Added
    overflow: 'hidden',   // Added
  }}
>
  <SessionView ... />
</div>
```

**Delete Functionality Status:**
- âœ… Delete option exists in `FileManager.tsx` (line 444) - Right-click on remote files
- âœ… Delete option exists in `LocalFileManager.tsx` (line 387) - Right-click on local files
- âœ… Both support deleting files and directories
- âœ… Confirmation dialog shown before deletion
- âœ… Uses `danger` style (red color) for delete option

**Files Modified:**
- `frontend/src/components/session/SessionView.css` - Fixed flexbox layout
- `frontend/src/App.tsx` - Fixed container flex properties

**Testing:**
- Clear cache: `rm -rf frontend/dist frontend/node_modules/.vite`
- Rebuild: `cd frontend && npm run build`
- Restart: `wails dev` (if using dev mode)

**Result:** âœ… Layout now completely fills window width, no blank space on right side. Delete functionality confirmed working.

---

## Previous Update (2026-02-06) âœ…

### Version 2.3 - Delete Functionality & Layout Fix

**New Features:**
- âœ… **Delete remote files/folders** - Right-click on remote files to delete via SFTP
- âœ… **Delete local files/folders** - Right-click on local files to delete
- âœ… **Delete confirmation dialog** - Safety confirmation before deletion
- âœ… **Fixed layout issue** - Three panes now properly fill the entire width

**Technical Changes:**
- Backend: Added `DeleteRemoteFile()`, `DeleteRemoteDirectory()`, `DeleteLocalFile()`, `DeleteLocalDirectory()` in `internal/app/local_files.go`
- Frontend: Added delete option to context menu in both `FileManager.tsx` and `LocalFileManager.tsx`
- Layout: Fixed flexbox layout to ensure panes fill 100% width (added `min-width: 0`, `width: 100%` to containers)

---

## Previous Issues (Resolved) âœ…

### Issue 1: Layout Problem - Empty Space on Right Side (RESOLVED âœ…)
**Problem Description:**
- The right side of the window shows empty space
- The three panes (Terminal, Remote Files, Local Files) use fixed widths instead of relative layout
- Total width exceeds 100% because panes use `width: XX%` plus two 4px dividers

**Previous Attempted Fix:**
- Changed from `width: ${paneWidths[0]}%` to `flex: paneWidths[0]` in `SessionView.tsx`
- Updated CSS to use `flex-shrink: 1` and `flex-basis: 0` for panes
- Added `width: 100%` to `.session-split-pane` container

**Final Solution (2026-02-06):**
- Removed `flex-shrink: 0` from `.session-split-pane` (was preventing proper flex behavior)
- Added `position: relative` to `.session-split-pane`
- Fixed container in `App.tsx` with `flex: '1 1 0'` and `overflow: 'hidden'`
- Cleared frontend cache and rebuilt

**Current Status:** âœ… **RESOLVED** - Layout now completely fills window width

**Code Changes:**
```typescript
// SessionView.tsx - Changed from width to flex
<div className="terminal-pane" style={{ flex: paneWidths[0] }}>
<div className="file-manager-pane" style={{ flex: paneWidths[1] }}>
<div className="local-files-pane" style={{ flex: paneWidths[2] }}>
```

```css
/* SessionView.css */
.session-split-pane {
  display: flex;
  height: 100%;
  width: 100%;  /* Added */
  overflow: hidden;
}

.terminal-pane,
.file-manager-pane,
.local-files-pane {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
  min-width: 100px;  /* Changed from 0 */
  flex-shrink: 1;    /* Added */
  flex-basis: 0;     /* Added */
}
```

---

### Issue 2: Drag Download Error - "file does not exist"
**Problem Description:**
- When dragging a file from remote file manager to local file manager, error occurs:
  ```
  Download failed: failed to open remote file: file does not exist
  ```

**Root Cause Analysis:**
- Remote file manager initial path is `~` (home directory)
- When dragging, path is constructed as `~/filename` or `/filename`
- SFTP client does NOT expand `~` like shell does
- `sftpClient.Open("~/filename")` fails because `~` is not a valid SFTP path

**Attempted Fix:**
1. **Backend (`local_files.go`)**:
   - Added `resolveRemotePath()` function to expand `~` to actual home directory
   - Uses `sftpClient.Getwd()` to get remote home directory
   - Modified `DownloadFile()`, `UploadFile()`, and `DownloadDirectory()` to call `resolveRemotePath()`
   - Added `GetRemoteHomeDir()` function exposed to frontend

2. **Frontend (`FileManager.tsx`)**:
   - Added `useEffect` to resolve `~` to actual remote home directory on initial load
   - Calls `GetRemoteHomeDir()` when `currentPath === '~'` and `sessionId` is available
   - Updates `currentPath` to resolved path

**Current Status:** âŒ **NOT RESOLVED** - Problem persists after fix

**Code Changes:**
```go
// local_files.go - Added path resolution
func resolveRemotePath(sftpClient *sftp.Client, remotePath string) string {
	if strings.HasPrefix(remotePath, "~/") {
		homeDir, err := sftpClient.Getwd()
		if err == nil {
			remotePath = homeDir + remotePath[1:]
		}
	} else if remotePath == "~" {
		homeDir, err := sftpClient.Getwd()
		if err == nil {
			remotePath = homeDir
		}
	}
	return remotePath
}

func (a *App) DownloadFile(sessionID string, remotePath string, localDir string) (string, error) {
	sftpClient, err := getSFTPClient(sessionID)
	if err != nil {
		return "", err
	}
	defer sftpClient.Close()

	// Resolve ~ to actual home directory
	remotePath = resolveRemotePath(sftpClient, remotePath)
	// ... rest of function
}
```

```typescript
// FileManager.tsx - Added home directory resolution
useEffect(() => {
  if (!sessionId) return;
  const resolveHome = async () => {
    if (currentPath === '~') {
      try {
        if ((window as any).go?.main?.App?.GetRemoteHomeDir) {
          const homeDir = await (window as any).go.main.App.GetRemoteHomeDir(sessionId);
          if (homeDir) {
            const resolved = homeDir.trim();
            setCurrentPath(resolved);
            setPathInput(resolved);
            return;
          }
        }
      } catch (err) {
        console.warn('Failed to resolve remote home dir, fallback to ~:', err);
      }
    }
  };
  resolveHome();
}, [sessionId]);
```

**Additional Context:**
- `FileManager.tsx` initial `currentPath` state is `'~'`
- `handleFileDragStart()` constructs path as: `currentPath === '/' ? \`/${file.name}\` : \`${currentPath}/${file.name}\``
- If `currentPath` is still `~` when dragging, path becomes `~/filename`
- Backend `resolveRemotePath()` should handle this, but may not be called correctly

**Files Modified:**
- `frontend/src/components/session/SessionView.tsx` - Changed width to flex
- `frontend/src/components/session/SessionView.css` - Updated flex properties
- `local_files.go` - Added `resolveRemotePath()` and `GetRemoteHomeDir()`
- `frontend/src/components/file-manager/FileManager.tsx` - Added home dir resolution

**Debugging Suggestions:**
1. **Layout Issue:**
   - Check browser DevTools to see actual computed widths of panes
   - Verify `flex` values are being applied correctly
   - Check if dividers (4px each) are causing overflow
   - Consider using `calc()` or different flex approach

2. **Path Resolution Issue:**
   - Add console.log in `handleFileDragStart()` to see what path is being set
   - Add log in `resolveRemotePath()` to see if it's being called
   - Verify `GetRemoteHomeDir()` is working correctly
   - Check if `currentPath` is still `~` when drag starts
   - Consider resolving path at drag start instead of on initial load

**Next Steps to Investigate:**
1. Check if `paneWidths` state values are correct (should sum to 100)
2. Verify flexbox layout is working as expected
3. Add more logging to trace path resolution flow
4. Test with absolute paths instead of `~` to isolate issue
5. Check SFTP client behavior with different path formats

---

### Version 2.2 - SFTP Transfers, Resizable Panes & Context Menu

Major feature update: real SFTP file transfer, resizable panes, and context menu!

### New Features (v2.2):
- âœ… **SFTP file download** - Download remote files to local via `pkg/sftp` (backend implemented)
- âœ… **SFTP file upload** - Upload local files to remote server via SFTP
- âœ… **SFTP directory download** - Recursively download remote directories
- âœ… **Draggable pane dividers** - Drag the dividers between Terminal/Remote/Local panes to resize
- âœ… **Right-click context menu** - Right-click on remote files to download, on local files to upload
- âœ… **Removed Upload/Download buttons** - Replaced by drag-and-drop and context menu
- âœ… **Drag-and-drop file transfer** - Drag local files to remote pane to upload, drag remote to local to download
- âœ… **File sorting** - Directories first, then alphabetical order
- âœ… **Hidden files filter** - Hidden files (starting with `.`) are filtered by default
- âœ… **Selected file highlight** - Click a file to highlight it
- âœ… **Improved folder icons** - Golden folder icons for better visibility
- âœ… **Up navigation button** - Arrow button to navigate to parent directory
- âœ… **Auto-refresh after transfer** - File panels refresh after upload/download completes

### Previous Features (v2.1):
- âœ… **Three-pane layout** - Terminal (40%) | Remote Files (30%) | Local Files (30%)
- âœ… **Percentage-based widths** - Responsive layout that adapts to window size
- âœ… **Local file browser** - Browse local files alongside remote files
- âœ… **Editable path inputs** - Click path bar to edit and jump to any directory (both remote & local)
- âœ… **Green connection indicator** - Connected sessions show green dot instead of red
- âœ… **Backend local file support** - Added GetHomeDirectory and ListLocalFiles methods
- âœ… **Enhanced terminal focus handling** - Added delayed focus and multiple focus triggers
- âœ… **Terminal I/O** - Backend uses Wails `runtime.EventsEmit`, frontend uses `EventsOn`
- âœ… **Fixed session ID mismatch** - Proper session lifecycle management
- âœ… **Terminal PTY session** - With proper stdin/stdout pipes, auto cleanup on close

#### Key Features Implemented:

1. **SSH Connection Backend** âœ…
   - Complete SSH connection management (`ssh_manager.go`)
   - Session pooling and lifecycle management
   - SSH key-based authentication
   - Remote command execution
   - File listing capabilities

2. **Modern Tab-Based Sessions** âœ…
   - Multi-tab interface for managing multiple SSH sessions
   - Real-time connection status indicators
   - Quick session creation from server list
   - Easy tab switching and closing

3. **Professional Split-Pane Layout** âœ…
   - Left: Full XTerm terminal with remote shell
   - Right: File manager with directory browsing
   - Resizable divider between panes
   - Each pane shows contextual information

4. **Beautiful Modern UI** âœ…
   - Dark theme with blue accents
   - Collapsible sidebar for server list
   - Search functionality
   - Breadcrumb navigation
   - Smooth animations

5. **File Manager** âœ…
   - Directory browsing and navigation
   - File/folder icons and details (golden folders, gray files)
   - Size, permissions, modification time
   - Click folders to navigate, double-click to enter
   - Right-click context menu (download, upload, open, refresh)
   - Drag-and-drop file transfer between local and remote
   - SFTP-based upload/download with progress notification
   - Hidden files filtered by default

#### Files Modified/Created:

**Backend:**
- `main.go` - Fixed embedded filesystem issue with `fs.Sub()`, now only handles app initialization
- `internal/app/ssh_manager.go` - Complete SSH connection management
  - Session pooling and lifecycle management
  - SSH key authentication
  - Command execution
  - File listing capabilities
- `internal/app/websocket_handler.go` - Terminal I/O handler
  - PTY session management
  - Real-time stdin/stdout/stderr handling
  - Terminal resize support
  - Graceful session cleanup
- `internal/app/local_files.go` - Local file management & SFTP transfers
  - GetHomeDirectory - Get user's home directory
  - ListLocalFiles - List local directory contents
  - DownloadFile - Download remote file to local via SFTP âœ…
  - UploadFile - Upload local file to remote via SFTP âœ…
  - DownloadDirectory - Recursively download remote directory âœ…
  - Uses `github.com/pkg/sftp` for reliable file transfers
- `internal/app/ssh.go` - SSH config parser
- `internal/app/app.go` - App structure

**Frontend:**
- `App.tsx` - Complete redesign with modern layout
  - Tab-based session management
  - Collapsible sidebar
  - Server search and filtering
  - Session connection state management
- `App.css` - Professional dark theme styling
- `components/session/SessionTabs.tsx` - Tab management component
  - Connection status indicators (green/red dots)
- `components/session/SessionView.tsx` - Three-pane session view
  - Terminal + Remote Files + Local Files
  - Draggable dividers for pane resizing (mousedown/mousemove/mouseup)
  - SFTP transfer handlers (upload/download) with progress notifications
  - Auto-refresh file panels after transfer
  - Fixed session ID synchronization
  - Proper lifecycle management
- `components/session/SessionView.css` - Three-pane layout styling
  - Dynamic width via inline styles
  - Smooth divider hover effects
- `components/terminal/Terminal.tsx` - Enhanced XTerm.js integration
  - Real-time PTY connection
  - Enhanced focus handling
  - Input/output handling with debug logging
  - Terminal resize support
- `components/terminal/Terminal.css` - Enhanced terminal styling
- `components/file-manager/FileManager.tsx` - Remote file manager
  - Remote directory browsing with sorting (dirs first)
  - Editable path input bar with up-navigation
  - Drag-and-drop upload (drop local files to upload via SFTP)
  - Right-click context menu (Download, Open dir, Refresh)
  - Hidden files filtered by default
  - Selected file highlight
- `components/file-manager/FileManager.css` - Remote file manager styling
  - Context menu with animation
  - Golden folder icons
- `components/file-manager/LocalFileManager.tsx` - Local file browser
  - Browse local directories with sorting (dirs first)
  - Editable path input with up-navigation
  - Drag-and-drop download (drop remote files to download via SFTP)
  - Right-click context menu (Upload to remote, Open dir, Refresh)
  - Hidden files filtered by default
  - Selected file highlight
- `components/file-manager/LocalFileManager.css` - Local file browser styling
  - Context menu with animation

#### How to Use:

**Development Mode:**
```bash
cd /Users/xd/Documents/xiedong_dev/mac_code/xterm-file-manager
wails dev
```

**Build for Production:**
```bash
# 1. Prepare icon (already done)
cp xterm.png build/appicon.png

# 2. Build the app
wails build

# 3. Run the app
open build/bin/xterm-file-manager.app
```

**Clear Cache & Rebuild (if changes don't appear):**
```bash
# Clear frontend cache
cd frontend
rm -rf dist node_modules/.vite

# Rebuild frontend
npm run build

# Restart wails dev (if using dev mode)
cd ..
wails dev
```

**Using the Application:**
1. Click a server from the left sidebar to create a session
2. Use tabs to switch between multiple sessions (green dot = connected)
3. Three-pane layout: Terminal (left) | Remote Files (middle) | Local Files (right)
4. **Drag dividers** between panes to resize them
5. Click path bar to edit and jump to any directory
6. Navigate folders by clicking, or edit path directly
7. **Drag files** between panes to upload/download via SFTP
8. **Right-click** on remote files â†’ Download to local
9. **Right-click** on local files â†’ Upload to remote
10. Close tabs with Ã— button or disconnect manually

#### Technical Details of Terminal I/O Fix:

**Problem**: Terminal could open but user input didn't show any response.

**Root Cause**: 
- Backend was receiving terminal output from SSH session âœ…
- Backend was NOT sending output back to frontend âŒ
- Frontend was NOT listening for backend output events âŒ

**Solution**:
1. **Backend (`websocket_handler.go`)**:
   - Import `github.com/wailsapp/wails/v2/pkg/runtime`
   - Modified `emitTerminalOutput()` to use `runtime.EventsEmit(a.ctx, "terminal:output", payload)`
   - Now properly sends terminal output events to frontend

2. **Frontend (`Terminal.tsx`)**:
   - Import `EventsOn` from Wails runtime
   - Setup event listener: `EventsOn('terminal:output', callback)`
   - When receiving output, write to XTerm: `term.write(payload.data)`
   - Properly cleanup listener on unmount

**Result**: Terminal is now fully interactive with real-time input/output! ğŸ‰

#### Next Steps:

- [x] Real-time PTY connection for terminal I/O âœ…
- [x] Terminal input/output event handling âœ…
- [x] Three-pane layout with local file browser âœ…
- [x] Editable path inputs for navigation âœ…
- [x] Connection status indicators âœ…
- [x] **SFTP implementation for file transfers** âœ…
  - DownloadFile via pkg/sftp âœ…
  - UploadFile via pkg/sftp âœ…
  - DownloadDirectory (recursive) âœ…
  - Drag-and-drop wired to SFTP backend âœ…
- [x] Resizable panes with drag dividers âœ…
- [x] Right-click context menu âœ…
- [x] **File delete operations** âœ…
  - DeleteRemoteFile / DeleteRemoteDirectory âœ…
  - DeleteLocalFile / DeleteLocalDirectory âœ…
- [ ] File operations (rename, create folder)
- [ ] Terminal themes and customization
- [ ] Session persistence
- [ ] Multi-file selection and batch transfer

---

## Previous Issues (Resolved) âœ…

### é»‘å±é—®é¢˜ (Black Screen Issue)

**Problem:** Application window showed black screen on startup.

**Root Cause:** Embedded filesystem path issue in `main.go`. The `//go:embed all:frontend/dist` embedded the files with the full path, but AssetServer expected files from the root of the embedded filesystem.

**Solution:** Used `fs.Sub(assets, "frontend/dist")` to extract the correct subdirectory before passing to AssetServer.

---

## é¡¹ç›®æ¦‚è¿°

ä½¿ç”¨ **Go + Wails v2** å¼€å‘çš„ä¸“ä¸š SSH ç»ˆç«¯æ–‡ä»¶ç®¡ç†å™¨ï¼Œå‰ç«¯ä½¿ç”¨ React + TypeScript + Ant Design + XTerm.jsã€‚

### æŠ€æœ¯æ ˆæ‘˜è¦
- **åç«¯**: Go 1.23+, Wails v2.11.0, SSH/SFTP libraries (`golang.org/x/crypto/ssh`, `github.com/pkg/sftp`)
- **å‰ç«¯**: React 18, TypeScript 5, Ant Design 5, XTerm.js 5, Vite 5
- **æ„å»º**: Wails CLI, npm/vite for frontend
- **éƒ¨ç½²**: macOS .app bundle, cross-platform support

### ä¸»è¦åŠŸèƒ½æ¨¡å—
1. **SSHè¿æ¥ç®¡ç†** (`internal/app/ssh_manager.go`): è¿æ¥æ± ã€ä¼šè¯ç”Ÿå‘½å‘¨æœŸã€å¯†é’¥è®¤è¯
2. **SSHé…ç½®** (`internal/app/ssh.go`): è§£æ `~/.ssh/config`
3. **ç»ˆç«¯I/O** (`internal/app/websocket_handler.go`): PTYä¼šè¯ã€å®æ—¶è¾“å…¥è¾“å‡ºã€Wailsäº‹ä»¶é€šä¿¡ (`terminal:output`)
4. **æ–‡ä»¶æ“ä½œ** (`internal/app/local_files.go`): æœ¬åœ°æ–‡ä»¶ã€SFTPä¸Šä¼ ä¸‹è½½ã€ç›®å½•é€’å½’æ“ä½œ
5. **ç»ˆç«¯ç»„ä»¶** (`Terminal.tsx`): XTerm.jsé›†æˆã€é€‰æ‹©å¤åˆ¶ã€å³é”®ç²˜è´´
6. **UIç»„ä»¶**: ä¸‰çª—æ ¼å¸ƒå±€ã€æ ‡ç­¾é¡µç®¡ç†ã€å·¥å…·é¡µé¢ (JSON/C/Escape Formatter)
7. **è®¾ç½®ç®¡ç†** (`internal/app/app.go`): ç»ˆç«¯è®¾ç½®æŒä¹…åŒ–ã€èœå•é›†æˆã€äº‹ä»¶é€šçŸ¥

---

## Previous Problem (Resolved)

**ç°è±¡**ï¼šåº”ç”¨çª—å£æ‰“å¼€åæ˜¾ç¤º**é»‘å±**ï¼ˆä¸æ˜¯ç™½å±ï¼‰ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹æ˜¾ç¤ºã€‚

**ç¯å¢ƒ**ï¼š
- macOS
- Go 1.22.0
- Wails v2.11.0
- Node.js (å‰ç«¯æ„å»ºæ­£å¸¸)

**æœåŠ¡å™¨çŠ¶æ€**ï¼š
- Wails å¼€å‘æœåŠ¡å™¨æ­£å¸¸è¿è¡Œåœ¨ `http://localhost:34115`
- ç«¯å£ 34115 æ­£å¸¸å“åº”ï¼ˆHTTP 200ï¼‰
- å‰ç«¯æ„å»ºæ–‡ä»¶å­˜åœ¨äº `frontend/dist/`

## é¡¹ç›®ç»“æ„

```
xterm-file-manager/
â”œâ”€â”€ main.go                      # åº”ç”¨å…¥å£ï¼Œåˆå§‹åŒ–å’Œèœå•
â”œâ”€â”€ internal/app/                # ä¸šåŠ¡é€»è¾‘åŒ… (package app)
â”‚   â”œâ”€â”€ app.go                   # App structã€è®¾ç½®ç®¡ç† API
â”‚   â”œâ”€â”€ ssh.go                   # ~/.ssh/config è§£æ
â”‚   â”œâ”€â”€ ssh_manager.go           # SSH è¿æ¥æ± ã€ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ websocket_handler.go     # ç»ˆç«¯ PTY I/O (Wails events)
â”‚   â””â”€â”€ local_files.go           # æœ¬åœ°æ–‡ä»¶æ“ä½œå’Œ SFTP
â”œâ”€â”€ go.mod / go.sum              # Go ä¾èµ–
â”œâ”€â”€ wails.json                   # Wails é…ç½®
â”œâ”€â”€ docs/                        # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ å·¥ç¨‹æ€»ç»“.md               # ä¸»æ–‡æ¡£ (AI reference)
â”‚   â”œâ”€â”€ QUICKSTART.md            # é¡¹ç›®å¿«é€Ÿå¯åŠ¨
â”‚   â”œâ”€â”€ RELEASE.md               # å‘å¸ƒè¯´æ˜
â”‚   â””â”€â”€ ...                      # å…¶ä»–æ–‡æ¡£
â”œâ”€â”€ scripts/                     # è¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ karabiner-config.json
â”‚   â””â”€â”€ test-keyboard.sh
â”œâ”€â”€ build/                       # æ„å»ºèµ„æº (appicon.png ç­‰)
â””â”€â”€ frontend/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.tsx             # React å…¥å£
    â”‚   â”œâ”€â”€ App.tsx              # ä¸»ç»„ä»¶
    â”‚   â””â”€â”€ components/
    â”‚       â”œâ”€â”€ terminal/        # ç»ˆç«¯ç›¸å…³ (Terminal, TerminalTab)
    â”‚       â”œâ”€â”€ file-manager/    # æ–‡ä»¶ç®¡ç†å™¨ (FileManager, LocalFileManager)
    â”‚       â”œâ”€â”€ editor/          # ä»£ç ç¼–è¾‘å™¨ (CodeEditor)
    â”‚       â”œâ”€â”€ session/         # ä¼šè¯ç®¡ç† (SessionTabs, SessionView)
    â”‚       â””â”€â”€ tools/           # å·¥å…·é¡µ (JSON/C/Escape Formatter)
    â”œâ”€â”€ wailsjs/go/app/          # Wails è‡ªåŠ¨ç”Ÿæˆçš„ç»‘å®š
    â””â”€â”€ dist/                    # æ„å»ºè¾“å‡º
```

## å…³é”®ä»£ç 

### main.go

```go
package main

import (
	"embed"

	"github.com/wailsapp/wails/v2"
	"github.com/wailsapp/wails/v2/pkg/options"
	"github.com/wailsapp/wails/v2/pkg/options/assetserver"
)

//go:embed all:frontend/dist
var assets embed.FS

func main() {
	appInstance := app.NewApp()

	err := wails.Run(&options.App{
		Title:     "XTerm File Manager",
		Width:     1400,
		Height:    900,
		MinWidth:  800,
		MinHeight: 600,
		AssetServer: &assetserver.Options{
			Assets: assets,
		},
		BackgroundColour: &options.RGBA{R: 30, G: 30, B: 30, A: 1},
		OnStartup:        app.startup,
		Bind: []interface{}{
			app,
		},
	})

	if err != nil {
		println("Error:", err.Error())
	}
}
```

### internal/app/app.go

```go
package app

import (
	"context"
)

type App struct {
	ctx context.Context
}

func NewApp() *App {
	return &App{}
}

func (a *App) Startup(ctx context.Context) {
	a.ctx = ctx
}

// GetSSHConfig is exposed to the frontend via Wails
func (a *App) GetSSHConfig() []SSHConfigEntry {
	return GetSSHConfig()
}
```

### frontend/src/App.tsx (å…³é”®éƒ¨åˆ†)

```tsx
const App: React.FC = () => {
  const [wailsReady, setWailsReady] = useState(false);

  useEffect(() => {
    // Check for Wails runtime
    const checkWails = () => {
      if ((window as any).go?.main?.App) {
        console.log('âœ… Wails runtime found!');
        setWailsReady(true);
        loadSSHConfig();
      } else {
        console.log('â³ Waiting for Wails runtime...');
        setTimeout(checkWails, 100);
      }
    };
    
    setTimeout(checkWails, 200);
  }, []);

  // Show loading screen if Wails not ready
  if (!wailsReady) {
    return (
      <div style={{ 
        padding: '40px', 
        color: '#fff', 
        background: '#1e1e1e',
        height: '100vh',
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center'
      }}>
        <Spin size="large" />
        <p style={{ marginTop: '20px', color: '#888' }}>Initializing Wails runtime...</p>
      </div>
    );
  }
  
  // ... rest of component
};
```

### frontend/dist/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XTerm File Manager</title>
    <script type="module" crossorigin src="./assets/index-Bat8xil8.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-DKQPELHY.css">
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
```

## Wails é…ç½® (wails.json)

```json
{
  "$schema": "https://wails.io/schemas/config.v2.json",
  "name": "xterm-file-manager",
  "outputfilename": "xterm-file-manager",
  "frontend": {
    "dir": "./frontend",
    "install": "npm install",
    "build": "npm run build",
    "dev": "npm run dev",
    "devServer": "http://localhost:5173",
    "devServerTimeout": 60000
  }
}
```

## è¿è¡ŒçŠ¶æ€

**ç»ˆç«¯è¾“å‡º**ï¼š
```
Wails CLI v2.11.0
Executing: go mod tidy
  â€¢ Generating bindings: Done.
Building application for development...
  â€¢ Generating bindings: Done.
  â€¢ Compiling application: Done.
  â€¢ Packaging application: Done.
Using DevServer URL: http://localhost:34115
INF | Serving assets from disk: /Users/xd/Documents/xiedong_dev/mac_code/xterm-file-manager/frontend/dist
```

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… ç«¯å£ 34115 æ­£å¸¸å“åº”
- âœ… `frontend/dist/index.html` å­˜åœ¨
- âœ… `frontend/dist/assets/` ç›®å½•å­˜åœ¨ä¸”åŒ…å« JS/CSS æ–‡ä»¶
- âœ… æµè§ˆå™¨è®¿é—® `http://localhost:34115` å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼ˆä½†åº”ç”¨çª—å£é»‘å±ï¼‰

## å·²å°è¯•çš„è§£å†³æ–¹æ¡ˆ

1. âœ… ç¡®è®¤ `Bind: []interface{}{app}` å·²è®¾ç½®
2. âœ… ç¡®è®¤å‰ç«¯å·²æ„å»º (`npm run build`)
3. âœ… ç¡®è®¤èµ„æºæ–‡ä»¶è·¯å¾„æ­£ç¡® (`frontend/dist`)
4. âœ… æ·»åŠ äº† Wails è¿è¡Œæ—¶æ£€æµ‹å’ŒåŠ è½½çŠ¶æ€
5. âœ… æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ—¥å¿—
6. âœ… ç¡®è®¤ `//go:embed all:frontend/dist` è·¯å¾„æ­£ç¡®

## å¯èƒ½çš„åŸå› 

1. **èµ„æºåµŒå…¥é—®é¢˜**ï¼š`//go:embed` å¯èƒ½æ²¡æœ‰æ­£ç¡®åµŒå…¥æ–‡ä»¶
2. **è·¯å¾„é—®é¢˜**ï¼šWails å¯èƒ½æ— æ³•æ‰¾åˆ°åµŒå…¥çš„èµ„æº
3. **WebView é—®é¢˜**ï¼šmacOS WebView å¯èƒ½æ²¡æœ‰æ­£ç¡®åŠ è½½å†…å®¹
4. **CORS æˆ–å®‰å…¨ç­–ç•¥**ï¼šèµ„æºåŠ è½½è¢«é˜»æ­¢
5. **JavaScript æ‰§è¡Œé”™è¯¯**ï¼šå‰ç«¯ä»£ç æ‰§è¡Œå¤±è´¥ä½†æ²¡æœ‰æ˜¾ç¤ºé”™è¯¯

## éœ€è¦çš„ä¿¡æ¯

1. **åº”ç”¨çª—å£æ˜¯å¦æœ‰ä»»ä½•å†…å®¹**ï¼Ÿï¼ˆå³ä½¿æ˜¯é”™è¯¯ä¿¡æ¯ï¼‰
2. **æµè§ˆå™¨è®¿é—® `http://localhost:34115` æ˜¯å¦æ­£å¸¸**ï¼Ÿ
3. **æ˜¯å¦æœ‰ä»»ä½•æ§åˆ¶å°è¾“å‡º**ï¼Ÿï¼ˆWails çª—å£å¯èƒ½æ²¡æœ‰å¼€å‘è€…å·¥å…·ï¼‰
4. **é‡æ–°æ„å»ºåé—®é¢˜æ˜¯å¦ä¾ç„¶å­˜åœ¨**ï¼Ÿ

## è°ƒè¯•å»ºè®®

1. **æ£€æŸ¥åµŒå…¥çš„æ–‡ä»¶**ï¼š
   ```go
   // åœ¨ main.go ä¸­æ·»åŠ è°ƒè¯•
   files, _ := assets.ReadDir(".")
   for _, file := range files {
       println("Embedded file:", file.Name())
   }
   ```

2. **ç®€åŒ–æµ‹è¯•**ï¼šåˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ HTML é¡µé¢æµ‹è¯•æ˜¯å¦èƒ½æ˜¾ç¤º

3. **æ£€æŸ¥ WebView**ï¼šç¡®è®¤ Wails ä½¿ç”¨çš„ WebView ç‰ˆæœ¬å’Œé…ç½®

4. **æŸ¥çœ‹ Wails æ—¥å¿—**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰éšè—çš„é”™è¯¯ä¿¡æ¯

## ç›¸å…³æ–‡ä»¶ä½ç½®

- ä¸»ç¨‹åºï¼š`/Users/xd/Documents/xiedong_dev/mac_code/xterm-file-manager/main.go`
- å‰ç«¯æ„å»ºï¼š`/Users/xd/Documents/xiedong_dev/mac_code/xterm-file-manager/frontend/dist/`
- Wails é…ç½®ï¼š`/Users/xd/Documents/xiedong_dev/mac_code/xterm-file-manager/wails.json`

## è¿è¡Œå‘½ä»¤

```bash
# æ„å»ºå‰ç«¯
cd frontend && npm run build && cd ..

# è¿è¡Œåº”ç”¨
export PATH=$PATH:$(go env GOPATH)/bin
wails dev

# æµ‹è¯•æœåŠ¡å™¨
curl http://localhost:34115
open http://localhost:34115
```

## é—®é¢˜æ€»ç»“

**æ ¸å¿ƒé—®é¢˜**ï¼šWails åº”ç”¨çª—å£æ˜¾ç¤ºé»‘å±ï¼Œä½†å¼€å‘æœåŠ¡å™¨æ­£å¸¸ï¼Œæµè§ˆå™¨è®¿é—®æ­£å¸¸ã€‚

**å…³é”®ç‚¹**ï¼š
- æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- å‰ç«¯æ„å»ºæ­£å¸¸
- èµ„æºæ–‡ä»¶å­˜åœ¨
- ä½†åº”ç”¨çª—å£æ— æ³•æ˜¾ç¤ºå†…å®¹

**éœ€è¦è§£å†³**ï¼šä¸ºä»€ä¹ˆåµŒå…¥çš„èµ„æºæ— æ³•åœ¨ Wails çª—å£ä¸­æ­£ç¡®åŠ è½½å’Œæ˜¾ç¤ºã€‚
